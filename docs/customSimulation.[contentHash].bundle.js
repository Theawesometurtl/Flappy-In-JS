(()=>{"use strict";var t={pipeTimer:100,timer:0,simulatedNNs:300,fitnessDictionary:{},NNKeepers:30,NNBrain:[4,8,8,8,6,4,1],bestNNs:{},mousePos:{},mutationRateMutationRate:.3,mutationMutationAmount:2,checkpoints:[[208,208],[489,122],[697,132],[907,196],[920,394],[794,481],[550,494],[350,466],[261,349],[453,292],[580,374]],checkpointSize:50,timerLimit:1e3,delay:20,human:!0,generationNum:0},i=document.querySelector("canvas");i.width=window.innerWidth,i.height=window.innerHeight;var e=i.getContext("2d"),r={Flappies:[],Pipes:[],Cars:[],NNs:[],Barrier:[]},o={};window.onkeyup=function(t){o[t.keyCode]=!1},window.onkeydown=function(t){o[t.keyCode]=!0};var n=document.getElementById("checkbox"),a=document.getElementById("rangeValue"),s=document.querySelector("#range");null!=n&&n.addEventListener("keydown",(function(t){32===t.keyCode&&t.preventDefault()})),null!=s&&null!=a&&(s.addEventListener("change",(function(i){a.innerHTML=s.value+" Simulation Speed",t.delay=20-.02*parseInt(s.value)})),s.addEventListener("mousemove",(function(i){a.innerHTML=s.value+" Simulation Speed",t.delay=20-.02*parseInt(s.value)})));var h=function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];return t.map((function(t){return 1/(1+Math.exp(-t))}))},c=function(t,i,e){if(e||2===arguments.length)for(var r,o=0,n=i.length;o<n;o++)!r&&o in i||(r||(r=Array.prototype.slice.call(i,0,o)),r[o]=i[o]);return t.concat(r||Array.prototype.slice.call(i))},l=function(){function t(){for(var i=[],e=0;e<arguments.length;e++)i[e]=arguments[e];this.neuronsPerLayer=i,this.biasArray=[],this.weightArray=[],t.NNAmount++,this.networkNumber=t.NNAmount,this.biasMutationRate=.1,this.biasMutationAmount=1,this.weightMutationRate=.1,this.weightMutationAmount=1}return t.prototype.createNeuralNet=function(t){void 0===t&&(t=0),this.biasArray[t]=[];for(var i=0;i<this.neuronsPerLayer[t];i++)Math.random()<.5?this.biasArray[t][i]=1:this.biasArray[t][i]=-1;if(++t!==this.neuronsPerLayer.length){this.weightArray[t]=[];for(i=0;i<this.neuronsPerLayer[t-1];i++){this.weightArray[t][i]=[];for(var e=0;e<this.neuronsPerLayer[t];e++)Math.random()<.5?this.weightArray[t][i][e]=1:this.weightArray[t][i][e]=-1}return this.createNeuralNet(t)}},t.prototype.fullMutate=function(t,i,e){void 0===t&&(t=0),void 0===e&&(e=.01);for(var r=0;r<this.biasArray[t].length;r++)Math.random()<this.biasMutationRate&&(this.biasArray[t][r]+=Math.random()-.5,this.biasArray[t][r]*=(Math.random()-.5+this.biasMutationAmount)/this.biasMutationAmount);if(++t!==this.biasArray.length){for(r=0;r<this.weightArray[t].length;r++)for(var o=0;o<this.weightArray[t][r].length;o++)Math.random()<this.weightMutationRate&&(this.weightArray[t][r][o]+=Math.random()-.5,this.weightArray[t][r][o]*=(Math.random()-.5+this.weightMutationAmount)/this.weightMutationAmount);return this.fullMutate(t,i,e)}},t.prototype.update=function(t){void 0===t&&(t=0);for(var i=[],e=1;e<arguments.length;e++)i[e-1]=arguments[e];if(++t>=this.neuronsPerLayer.length)return i;var r=[];return r=this.updateBiases(t,0,r),r=this.updateWeights(t,0,0,r,i),r=h.apply(void 0,r),this.update.apply(this,c([t],r,!1))},t.prototype.updateBiases=function(t,i,e){return void 0===t&&(t=0),void 0===i&&(i=0),e[i]=this.biasArray[t][i],++i>=this.biasArray[t].length?e:this.updateBiases(t,i,e)},t.prototype.updateWeights=function(t,i,e,r,o){return void 0===t&&(t=0),r[e]+=this.weightArray[t][i][e]*o[i],++e>=this.weightArray[t][i].length&&(e=0,++i>=this.biasArray[t-1].length)?r:this.updateWeights(t,i,e,r,o)},t.NNAmount=0,t}(),u=function(){function t(){this.width=50,this.gapHeight=200,t.numOfPipes++,this.pipeNum=t.numOfPipes,this.position={x:i.width+this.width,y:Math.random()*(i.height-this.gapHeight)+this.gapHeight/2},this.velocity={x:-9,y:0}}return t.prototype.update=function(){if(this.position.x+=this.velocity.x,this.velocity.y+=this.velocity.y,this.position.x<0-this.width){var t=void 0;for(t in r.Pipes)r.Pipes[t].pipeNum===this.pipeNum&&r.Pipes.splice(t,1)}},t.prototype.draw=function(){e.fillStyle="green",e.fillRect(this.position.x-this.width/2,0,this.width,this.position.y-this.gapHeight/2),e.fillRect(this.position.x-this.width/2,this.position.y+this.gapHeight/2,this.width,i.height+1e3)},t.numOfPipes=0,t}(),p=function(){function r(){this.position={x:50,y:i.height/2},this.velocity={x:0,y:0},this.width=50,this.height=50,this.jumpVelocity=21,this.drag=.9,this.gravity=3}return r.prototype.jump=function(){this.velocity.y=-this.jumpVelocity},r.prototype.update=function(){this.position.x+=this.velocity.x,this.position.y+=this.velocity.y,this.velocity.x*=this.drag,this.velocity.y+=this.gravity,this.velocity.y*=this.drag,!0===o[32]&&t.human&&this.jump()},r.prototype.draw=function(){e.fillStyle="yellow",e.fillRect(this.position.x-this.width/2,this.position.y-this.height/2,this.width,this.height),e.strokeStyle="black",e.lineWidth=3,e.beginPath(),e.moveTo(this.position.x-this.width/2,this.position.y-this.height/2),e.lineTo(this.position.x+this.width/2,this.position.y-this.height/2),e.lineTo(this.position.x+this.width/2,this.position.y+this.height/2),e.lineTo(this.position.x-this.width/2,this.position.y+this.height/2),e.closePath(),e.stroke()},r.prototype.die=function(){this.position.y=100,this.velocity.y=0},r}(),y=function(){function t(){this.c=-1}return Object.defineProperty(t.prototype,"count",{get:function(){return this.c++,this.c},set:function(t){this.c=t},enumerable:!1,configurable:!0}),t}();function g(t,i){for(var e=i.length.toString(),r=0;r<i.length;r++)e=e+" "+i[r].length.toString();for(r=0;r<i.length;r++)for(var o=0;o<i[r].length;o++)e=e+" "+i[r][o].toString();for(r=1;r<t.length;r++)for(o=0;o<t[r].length;o++)for(var n=0;n<t[r][o].length;n++)e=e+" "+t[r][o][n].toString();return e}function v(t){for(var i=t.split(" "),e=[],r=0;r<i.length;r++)e.push(parseFloat(i[r]));for(var o=new y,n=e[o.count],a=[],s=[],h=[],c=0;c<n;c++)a[c]=e[o.count];for(c=0;c<n;c++){s[c]=[];for(var l=0;l<a[c];l++)s[c][l]=e[o.count]}for(c=1;c<n;c++){h[c]=[];for(l=0;l<a[c-1];l++){h[c][l]=[];for(var u=0;u<a[c];u++)h[c][l][u]=e[o.count]}}return[s,h]}function f(t,i,e){return Math.random()<t&&(e*=(i+Math.random()-.5)/i),e}var d=function(t,i,e){if(e||2===arguments.length)for(var r,o=0,n=i.length;o<n;o++)!r&&o in i||(r||(r=Array.prototype.slice.call(i,0,o)),r[o]=i[o]);return t.concat(r||Array.prototype.slice.call(i))};function N(t,i){for(var e=0;e<t.length-1;e++)for(var r=0;r<i.length-1;r++){if(m(t[e],t[e+1],i[r],i[r+1])[0])return!0}return!1}function m(t,i,e,r){var o,n=t[0],a=t[1],s=i[0],h=i[1],c=e[0],l=e[1],u=r[0],p=r[1];if(n===s&&a===h||c===u&&l===p)return[!1];if(0===(o=(p-l)*(s-n)-(u-c)*(h-a)))return[!1];var y=((u-c)*(a-l)-(p-l)*(n-c))/o,g=((s-n)*(a-l)-(h-a)*(n-c))/o;return y<0||y>1||g<0||g>1?[!1]:[!0,n+y*(s-n),a+y*(h-a)]}function w(t,i,e){var r=[t,i,e];return r.sort((function(t,i){return i-t})),r[1]===e}function M(t,i){return Math.sqrt(Math.pow(t,2)+Math.pow(i,2))}var A=function(){function i(){for(var i=[],e=0;e<arguments.length;e++)i[e]=arguments[e];this.angularDrag=.85,this.position={x:t.checkpoints[0][0],y:t.checkpoints[0][1]},this.velocity={x:0,y:0},this.angle=0,this.accelleration=.4,this.length=4,this.width=10,this.angularVelocity=0,this.angularAcceleration=3,this.drag=.95,this.vertices=[[this.length,this.width],[-this.length,this.width],[-this.length,-this.width],[this.length,-this.width]],this.vertexCoords=[];for(var r=0;r<this.vertices.length;r++)this.vertexCoords[r]=[],this.vertexCoords[r][0]=this.vertices[r][0]+this.position.x,this.vertexCoords[r][1]=this.vertices[r][1]+this.position.y;this.checkpointReached=0}return i.prototype.draw=function(){e.strokeStyle="purple",e.lineWidth=1,e.fillStyle="white",e.beginPath(),e.moveTo(this.vertexCoords[0][0],this.vertexCoords[0][1]);for(var t=1;t<this.vertices.length;t++)e.lineTo(this.vertexCoords[t][0],this.vertexCoords[t][1]);e.closePath(),e.fill(),e.stroke()},i.prototype.update=function(){this.angularVelocity*=this.angularDrag,this.angle+=this.angularVelocity;var i=Math.PI/180*this.angle,e=Math.cos(i),o=Math.sin(i);this.velocity.x+=this.accelleration*e,this.velocity.y+=this.accelleration*o;var n=M(this.velocity.x,this.velocity.y);if(0!==n){var a=0;this.velocity.y<0?(a=Math.PI,a+=-Math.atan(this.velocity.x/-this.velocity.y)):a+=Math.atan(this.velocity.x/this.velocity.y),n*=this.drag,this.velocity.x=n*Math.sin(a),this.velocity.y=n*Math.cos(a),w(t.checkpoints[this.checkpointReached%t.checkpoints.length][0]-t.checkpointSize,t.checkpoints[this.checkpointReached%t.checkpoints.length][0]+t.checkpointSize,this.position.x)&&w(t.checkpoints[this.checkpointReached%t.checkpoints.length][1]-t.checkpointSize,t.checkpoints[this.checkpointReached%t.checkpoints.length][1]+t.checkpointSize,this.position.y)&&this.checkpointReached++}this.position.x+=this.velocity.x,this.position.y+=this.velocity.y;for(var s=0;s<this.vertices.length;s++)this.vertexCoords[s][0]=o*this.vertices[s][0]+e*this.vertices[s][1]+this.position.x,this.vertexCoords[s][1]=o*this.vertices[s][1]-e*this.vertices[s][0]+this.position.y;for(var h=0;h<r.Barrier[0].vectors.length;h++)if(N(this.vertexCoords,r.Barrier[0].vectors[h]))return!0;return!1},i.prototype.steer=function(t){t>.5?(t=1-t,t=.5-(t=Math.pow(t,2)),this.angularVelocity+=t*this.angularAcceleration):t<.5&&(t=-.5+(t=Math.pow(t,2)),this.angularVelocity+=t*this.angularAcceleration)},i}(),k=function(){function t(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];this.vectors=t}return t.prototype.draw=function(){e.strokeStyle="black",e.lineWidth=5,e.beginPath();for(var t=0;t<this.vectors.length;t++){e.moveTo(this.vectors[t][0][0],this.vectors[t][0][1]);for(var i=1;i<this.vectors[t].length;i++)e.lineTo(this.vectors[t][i][0],this.vectors[t][i][1]);e.stroke()}},t}(),b=function(t,i,e){if(e||2===arguments.length)for(var r,o=0,n=i.length;o<n;o++)!r&&o in i||(r||(r=Array.prototype.slice.call(i,0,o)),r[o]=i[o]);return t.concat(r||Array.prototype.slice.call(i))};function C(i){r.Pipes=[],r.Flappies=[],r.Barrier=[],r.Cars=[],t.generationNum++;var e=function(i){void 0===i&&(i=1);var e=t.fitnessDictionary;t.fitnessDictionary={};var o=Object.keys(e).map((function(t){return[parseInt(t),e[parseInt(t)]]}));o.sort((function(t,i){return i[1]-t[1]}));var n=o[0][1],a=r.NNs[o[0][0]];n>=4&&(console.log(n,a.networkNumber,g(a.weightArray,a.biasArray)),t.bestNNs[o[0][1]]=g(a.weightArray,a.biasArray));for(var s=1;s<t.simulatedNNs;s++)o[s][1]*=(Math.random()+i)/i;o.sort((function(t,i){return i[1]-t[1]})),o=o.slice(0,t.NNKeepers);for(var h=[],c=0;c<t.simulatedNNs/o.length;c++)h.push.apply(h,o);return h}(10);if(function(i){for(var e=[],o=0;o<i.length;o++){e[o]=new(l.bind.apply(l,d([void 0],t.NNBrain,!1))),e[o].createNeuralNet();var n=v(g(r.NNs[i[o][0]].weightArray,r.NNs[i[o][0]].biasArray));e[o].biasArray=n[0],e[o].weightArray=n[1],e[o].biasMutationAmount=r.NNs[i[o][0]].biasMutationAmount,e[o].biasMutationRate=r.NNs[i[o][0]].biasMutationRate,e[o].weightMutationAmount=r.NNs[i[o][0]].weightMutationAmount,e[o].weightMutationRate=r.NNs[i[o][0]].weightMutationRate}r.NNs=[];for(var a=0;a<e.length;a++)r.NNs.push(e[a]);for(var s=0;s<t.NNKeepers;s++);for(a=t.NNKeepers;a<t.simulatedNNs;a++){r.NNs[a].fullMutate(0,.3,.03);var h=r.NNs[a],c=h.biasMutationAmount,u=h.biasMutationRate,p=h.weightMutationAmount,y=h.weightMutationRate;r.NNs[a].biasMutationAmount=f(t.mutationRateMutationRate,t.mutationMutationAmount,c),r.NNs[a].weightMutationAmount=f(t.mutationRateMutationRate,t.mutationMutationAmount,p),r.NNs[a].biasMutationRate=f(t.mutationRateMutationRate,t.mutationMutationAmount,u),r.NNs[a].weightMutationRate=f(t.mutationRateMutationRate,t.mutationMutationAmount,y)}}(e),t.timer=0,i){t.pipeTimer=0,u.numOfPipes=0,r.Pipes.push(new u);for(var o=0;o<t.simulatedNNs;o++)r.Flappies.push(new p)}else{for(o=0;o<t.simulatedNNs;o++)r.Cars.push(new A);var n=JSON.parse(localStorage.getItem("barrier"));console.log(n),r.Barrier.push(new(k.bind.apply(k,b([void 0],n,!1))))}}var x=function(t,i,e){if(e||2===arguments.length)for(var r,o=0,n=i.length;o<n;o++)!r&&o in i||(r||(r=Array.prototype.slice.call(i,0,o)),r[o]=i[o]);return t.concat(r||Array.prototype.slice.call(i))};function S(){t.generationNum=0,r.Pipes=[],r.Flappies=[],r.Barrier=[],r.Cars=[];var i=JSON.parse(localStorage.getItem("barrier"));if(t.human)r.Cars.push(new A),r.Barrier.push(new(k.bind.apply(k,x([void 0],i,!1))));else{for(var e=0;e<t.simulatedNNs;e++){if(r.Cars.push(new A),r.NNs.push(new(l.bind.apply(l,x([void 0],t.NNBrain,!1)))),r.NNs[e].createNeuralNet(0),JSON.parse(localStorage.getItem("preTrained"))){var o=v("8 14 11 13 10 7 7 4 1 1.3581771430694722 0.7970955363935348 -0.08261230812091964 8.00814658372796 0.7057852126740809 1.5755421367670481 0.054660602001640426 -0.5651513462239095 2.0768824915773823 2.0014290363378238 -0.5835425320071465 0.8412169557279497 -0.9498620629077463 14.575942578659197 -0.3250753244642311 -4.438304625442311 -0.02197673603410333 -1.345466059741066 0.44417191915172893 -0.31236899655524103 -0.6945341837788936 -3.838422541804104 -0.7212452338507659 -0.5709623301416278 0.5452570069569027 2.6155050190836593 0.29760568322234376 1.513857708082667 0.2696219883953061 0.9845639230401325 -0.47728577442633924 -14.144373898602058 0.3551382290008129 -0.1428615650002556 -5.529684185007309 -0.6873853009448304 -0.08391081817562547 12.778083478180914 -0.6920762340630303 1.3034358258892826 0.6329964964295113 0.5165066840047845 4.989071099572066 -0.9442612480524757 1.040026711006844 -0.6565129851798077 0.32431831488423185 0.6710167746839425 -0.4441592920282546 -0.03146866989533553 -4.121536425518289 -0.8365494255847065 1.245443772079633 0.3822871320306917 1.9268465069822276 1.7666860725213194 0.4023748267461817 0.045467312798156016 -0.0780075748894102 0.5472905535456343 -1.197812280002129 0.2490731971797289 1.4953723733617097 -0.6882514822026673 -0.16701101044904826 0.4004139750986038 0.3640093053016464 0.10987610515170236 0.04498565135295985 -0.36606110668128283 -2.293514463506518 -1.1355428542946469 0.3302750655766364 -9.40252180984528 -0.36242839146480443 -1.177153472880573 -1.7867377460312064 0.09535413383060694 -0.456455556805654 0.43954109027893284 -1.631811863911082 -12.948796606540933 1.5637933040087855 -0.9354765847305242 1.2593531321182283 -0.4196098102759246 0.8231752553992523 -1.680490904855087 1.5274529927670357 0.4861299576015063 0.13133254047220114 -1.605761260970399 -0.5457107134076468 -2.337742197351878 0.31344595194369745 0.6989858397836523 1.479270923580409 0.21426426133917312 -3.8157937465952445 -0.26676571068873817 -0.7796155920809265 -0.1905995744736536 0.10624899966804037 0.6328589868660424 1.2439342587191657 0.6109462034105697 -0.20617525731114392 0.6489051201815381 -2.349124891475449 -1.469338614832991 0.8788389650264574 0.36225387718263985 -1.2816394784218923 -0.8857761547212694 -0.6417428499592354 -0.1676661078250261 -2.4353750147451745 -0.5416749713912498 -3.0584434535425564 -0.29816615524177537 11.298389413401551 1.2673321137837128 1.0908264388746165 -0.2815225553404052 -3.2003313254891714 -0.48015575857064025 0.4924518249168473 -2.65481737773984 -0.4525777652943415 2.0210973042884213 0.5987198297146727 -0.6615405785345956 1.1390905565324883 0.2631959703898148 2.0641490384571637 0.9028743053350309 8.53863334666446 0.1956044992219231 -1.2773932278941251 0.04457853019687213 -3.9512487079477197 1.0466517731970977 0.2760367551856109 -1.1309188792925002 -0.406953537928735 1.0594145774554609 4.298324160600866 10.280704267284616 2.0596237773590644 0.21851524805272157 3.21781419689613 2.5285164752868847 -0.07059794922674542 -4.549113508032462 -0.4783010182926448 0.3111851605030114 -0.43289127562901136 4.997522369807376 -0.31007088226300206 -0.7642679307933017 -8.116538253635719 -0.9865945754498114 0.40846802932051784 -3.3147140093484047 4.347265600782744 0.3792386564541296 0.5318639778062827 0.1397143107787668 1.4645502326446387 -0.07810424650322696 19.559945636073493 1.0126385179086719 -1.2069360279600718 -0.8987635633128422 -0.5871666308370189 -1.6399382250568146 -0.2510072742192859 20.681953597475356 -2.0634908648731805 -0.4225718790525354 -0.13468575780325548 1.0074787776847296 1.3885680937764682 0.7411223216908103 0.3013667923137242 -2.1114159530879877 0.6935718996332806 0.319219754657443 1.270746162323264 -0.5616187008851531 -2.171085798618692 -0.6557693770095752 -1.0070400695448494 -1.3250298785566454 1.9185003231602715 1.0989127023898704 -0.4748921628804399 19.010983738688875 1.2290290099328103 0.21733683091208295 -1.6117708122544716 0.501422984526336 0.5250781893526608 -0.9220755830538367 -0.12834419382671564 1.1128310695808923 1.185084554690355 0.5536564606148059 -1.161998900759295 -0.21831462425037995 -1.4010599186007036 -1.64597690623281 -0.3339560090183197 2.161458745817546 -1.9785928881620005 -0.2660270982051246 -1.0299820228776462 -1.441354760373545 0.12644057578783227 -0.10030123355390876 2.484721670054204 0.36849358096402196 -0.037547934330388645 0.2770707512846673 1.7610185847725517 6.046059057143798 0.918801772363375 0.4480712374472155 0.19911926099329444 -0.05574900870783505 1.4609933200953376 8.700252497410109 1.557605553670329 0.17989892674509694 -0.9458870185833288 -0.39146110128225736 -0.12542430461812842 26.218832861063348 -8.741631850345327 0.4457508777829596 -0.6780342233608824 -1.3383346598952977 2.2617660045240147 -0.1343582031423524 -0.5509463636384051 -1.5581999578866965 -0.11940283393791704 1.7890718127883758 14.78835647759965 -0.046837456104406025 -1.5080507718585923 5.363757725602957 4.814956483637623 0.04664555351439878 0.12088062193320642 -1.2669375313489917 -0.451401891003847 -1.7724518701820522 -2.0404147398951973 -0.8935228972199566 1.4494068461079954 -26.18370084291567 -2.0688648209206906 1.6862180619698661 -2.601795705111721 11.926191203608202 38.35210226294789 -0.183344806038061 0.04545806790292264 -1.378680454014087 -0.3227238136444896 -0.11650868309874575 -24.59530609295547 -0.897333075308169 -0.5874576472085511 -2.1420268450010593 -3.780905128602819 -0.9874692037030343 5.850698080481952 -1.0368135236543103 0.572467305454151 -1.8502625343425068 -2.6790956120075333 -3.165891572508121 -3.4832669114614165 -1.8963433897259419 2.1379030394449776 2.319167960685971 0.6399627983132228 1.3628241250530322 2.117437185227778 0.4474960346993403 -1.8766478941738465 2.0453326134269765 3.701559630826241 26.195379928002108 -11.034618065541688 5.819260927630012 -3.1375408096404684 -1.601906393859947 -1.3874713139735035 -3.6369219162767257 0.4453085207605811 0.8839216255260111 -5.4710671944827975 -0.5673268152715952 1.7919407257182363 6.332951604931168 -11.24580978914082 -7.225510897906424 1.6793324027278176 3.9955522656891596 -5.84686257837162 -0.9002924663220352 -1.431060533883592 -0.33415109628417855 -0.820567944638864 -0.6104028608054287 0.18949802719358116 -1.189741824818562 -1.6728809706600933 -2.8900227887976166 -2.838413035442836 2.696168637925417 1.2268895790248182 -1.592270793716863 1.3272654745581205 -0.23194345281732842 -3.297949045776976 1.3647516337404229 0.5350411923600021 -2.2454005184487005 1.5244803494978623 -1.7113821616434424 0.9463087590628804 1.7809585637477876 0.13430938151171554 0.7108396255719821 -0.15481074226565858 -4.180154298504205 0.6779702516962707 2.2850468417715684 0.9762694841507301 0.1607233870951834 2.844713927746514 -2.7794367241723785 0.03902591721436548 0.9367680907989806 0.0793030389311663 1.0405085918705206 -0.965545021561065 -0.6740756078498839 -0.2864577298574037 -0.3936300486763387 0.2458170805125753 3.2552513976614366 -1.0456455045009683 4.113078758434315 1.5002038661130834 0.7785799053448422 -1.097765450924622 -0.4743538863775782 -3.7305369575685683 1.5424901341665205 0.12644325435199805 0.4173639998040087 -0.6446457160756927 -0.6554718025404876 0.6058674081847657 -0.45340373275735296 -0.3438444756838451 0.2799325187736496 2.3753349384806133 0.9222321022268529 -0.5788172571404292 1.019691664942824 -0.14508248852779462 -0.37678021937281436 -0.8549491312596406 -1.0001994519100357 0.9594871232059815 8.655321303447622 -3.246479793411403 0.30374093513331674 0.9091496521571755 -0.6319696287359279 1.0800837233371143 20.88871333510106 -0.05282366464478978 -0.4505128520093259 -3.4102724164362517 0.4116061252297881 0.603690889385153 -2.3471650015769137 -1.5564768875511181 -1.2664050497318278 -0.1541670719923 -1.9671804433723619 -0.9284385148663212 -0.15933797894099716 2.7559265440264813 -1.1305673414329904 0.18267196546632525 1.098789092864863 -5.0641049388042285 5.774007540660025 0.40023201283287235 -0.9610364197980327 2.2501827532100047 0.24868267088037957 -0.11192707293946699 13.443434037474837 -1.2091367364149297 0.8472132598587458 -0.8412430569709941 1.6219155400622678 0.6068074464795136 -4.080375656705576 0.7393053458618856 -2.490854963836044 -7.766292594702413 1.0296607512975133 5.5320603848583385 0.004573160265810911 -1.0026520215890768 -2.7907536551175 0.7030433387893691 -1.451971453968367 0.6344888795716107 0.23659751544505858 40.159560028905055 2.4163862779105387 -2.1028373843866643 5.9316500752340335 1.016814536256304 1.1865914155960864 -2.7815675108146443 -2.1578396492704166 0.013139604342068137 0.9128958762506115 0.1463286662064296 13.21883922361084 1.479379706596265 -0.10569059989800698 0.7635271459389331 -0.08172356248374074 0.32392871148053903 0.5526948780271085 -0.83847388069578 1.004155576678703 -1.2093060701064509 0.7652492379270112 -0.2472524142950473 0.18559757218555425 1.9974047134715445 1.69475438369726 -0.4429584451290436 -0.1982165863578391 1.6805020002493944 -2.4698270938055424 3.3835342441834966 1.8277040473390451 3.515723309568576 -1.8263558931549824 -0.18418386183176977 0.2132415099367175 -0.8026962006670499 0.16606669517017467 -1.1329140942075553 -1.5581622634043437 0.38105529962437373 0.8810814461135578 -0.04110121732020588 0.30085653202879464 1.2498368612242963 0.21843250369698722 0.7313752996952056 -1.2648861982380735 -1.0059258472002834 1.4410311655473353 -0.9590978262824604 -1.3902556033185332 0.24077062327570567 0.3122199482733704 -9.06963550584436 0.45908124642799714 1.4231304167593017 -0.9510215389638718 0.5784302862314539 0.8429912462231158 -1.7240860061128722 -0.4748376896061888 -0.27137492890886356 0.7802657975104188 1.661538429067846 -1.2836138052121473 -0.349320642124829 -15.115689257843572 0.5667310971940865 -2.1867376986737987 2.62057360844866 -0.5615653482576538 2.406034574082109 0.29013168999586714 -0.31094156769173825 0.11847182261502859 -1.9891774232390664 6.993338855672175 -1.111690238519983 2.496212135852749 0.4483809541454335 -1.5328654870854066 1.0225737875218708 -1.508929458056443 -1.087880181539366 -0.1572014903164785 3.134062628632671 -8.785349796162578 0.32261419422809856 0.16023024403830727 3.2631316505568955 1.5229832054381576 1.9763773267857447 0.5819684480662138 0.486028935384502 -0.05828852031140603 0.12028958241140215 -0.8726922620009853 -0.6164323695455616 0.7500644428276598 1.8604407360872226 2.399053445714263 -0.5811578836737094 4.099637832379876 0.0039989596645218515 -0.0811624115232269 0.25045796926724995 -1.4063892961572115 7.899106195015891 1.0166420286035536 0.7778642799510734 1.9866461173416452 0.07580075889459148 1.4644228319482824 0.13758224535112024 -0.3179415731783475 0.7284777383506581 0.20309848986989745 -0.4760898171973243 -0.6230711781551094 0.7716734456245096 -3.4770927392258537 -2.778846511232658 0.08292038370713604 0.5952372871067768 0.20768462573702168 -0.17159470797483312 1.079955289859254 -0.5561534055633804 0.5523936142418273 6.201177376481603 4.115806722932169 -0.3960216509268587 -6.5173623464118595 -0.006063067773816549 -2.1021825950014654 -1.5095995295942748 -5.37941324603147 -1.4726508286676763 1.228470647084908 0.48289940546414345 0.18679417261515177 0.30388587589874194 0.9020629658462916 -1.7697523179989914 0.10894267141274133 -0.8898013412908619 -1.026842835129087 -0.42265444689500836 -0.21322631623877364 2.0728498202777845 0.362565823178321 2.0832429309283107 5.453521845332349 0.5852649417648005 -0.7867801461851748 1.3691032222282522 -0.12577282870177472 -0.17971350040215614 -0.2071435799170507 -0.35944043749202564 0.2863101106839109 1.2197940329211936 3.3265594345430625 0.23264325994372584 1.4814507493148683 1.302929477471479 0.026139497383560844 2.7566824564971193 3.962358114848428 -0.5629929889210321 -0.9209438616521993 1.4820565165769888 0.1159110233176536 -0.5916424007620686 0.5702465932123948 0.6866317761183899 0.12654402571534756 -1.4226491931639367 0.8876668719901353 0.11529179082440096 -2.121764772241704 0.2330085093631796 1.047263494036983 -0.9668235810017796 0.5008730092016087 -32.109627768809 1.513361612180449 0.9206756016451756 0.24346522523032774 3.2768280680475583 -1.1290184819830027 -1.0316518151556047 6.990978448346649 0.08054088124631227 -0.9158152302690193 2.280776643008786 -4.72062987604463 -1.079225906680309 -1.2223125444531202 -3.0077335202585584 -0.21415451517873568 3.4221516855326746 -8.050701039292756 3.361370389123801 -1.8930805508984438 1.6245379156553617 0.26511336069979874 1.8011004727046371 -7.303174136121818 3.8724847361362666 -6.227346133655841 2.0610993907343005 0.3007127578181042 2.425427292435251");r.NNs[e].biasArray=o[0],r.NNs[e].weightArray=o[1]}t.fitnessDictionary[e]=e}C(!1)}}function R(t){var i=t.toString(16);return 1==i.length?"0"+i:i}function P(t,i,e){return"#"+R(t)+R(i)+R(e)}function B(t,i,r,o,n,a){e.beginPath(),e.arc(n,a,t,0,2*Math.PI,!1),e.fillStyle=i,e.fill(),e.lineWidth=o,e.strokeStyle=r,e.stroke()}function T(t,i,r,o,n,a,s){if(void 0===s&&(s=0),function(t,i,e,r,o,n){void 0===n&&(n=0);for(var a=0;a<o[n].length;a++)I(o[n][a]),B(9,I(o[n][a]),"black",3,n*t+e,a*i+r)}(t,i,r,o,a,s),++s!==a.length)return function(t,i,r,o,n,a){void 0===a&&(a=0);for(var s=0;s<n[a].length;s++)for(var h=0;h<n[a][s].length;h++){var c=n[a][s][h],l=I(c=Math.round(c));e.strokeStyle=l,e.lineWidth=1,e.beginPath(),e.moveTo((a-1)*t+r,s*i+o),e.lineTo(a*t+r,h*i+o),e.stroke()}}(t,i,r,o,n,s),T(t,i,r,o,n,a,s)}function I(t){return t<0?P(255,t=225-100*t,t):P(t=225-100*t,255,t)}function L(t,i,r){for(var o=[],n=3;n<arguments.length;n++)o[n-3]=arguments[n];e.font="30px Arial",e.fillStyle="white";for(var a=0;a<o.length;a++)e.fillText(o[a].toString(),t,i+a*r)}function W(t,i,r){var o,n=1e4;i=i*Math.PI/180;for(var a=[t.x+Math.sin(i)*n,t.y+Math.cos(i)*n],s=n,h=[a[0],a[1]],c=0;c<r.length;c++)for(var l=0;l<r[c].length-1;l++)(o=m([t.x,t.y],a,r[c][l],r[c][(l+1)%r[c].length]))[0]&&M(o[1]-t.x,o[2]-t.y)<s&&(s=M(o[1]-t.x,o[2]-t.y),h=[o[1],o[2]]);return e.strokeStyle="red",e.lineWidth=.1,e.beginPath(),e.moveTo(t.x,t.y),e.lineTo(h[0],h[1]),e.stroke(),s}var O,V,z=function(t,i,e){if(e||2===arguments.length)for(var r,o=0,n=i.length;o<n;o++)!r&&o in i||(r||(r=Array.prototype.slice.call(i,0,o)),r[o]=i[o]);return t.concat(r||Array.prototype.slice.call(i))};t.checkpoints=JSON.parse(localStorage.getItem("checkpoint")),t.NNBrain=[11,11,13,10,7,6,4,1],S(),O=function(){var n,a;e.fillStyle="#af73b1",e.fillRect(0,0,i.width,i.height);var s=document.getElementById("checkbox");if(t.human)!0!==o[65]&&!0!==o[37]||r.Cars[0].steer(0),!0!==o[68]&&!0!==o[39]||r.Cars[0].steer(1),r.Barrier[0].draw(),r.Cars[0].update()&&(r.Cars[0].position={x:t.checkpoints[0][0],y:t.checkpoints[0][1]},r.Cars[0].velocity={x:0,y:0},r.Cars[0].angle=0,r.Cars[0].angularVelocity=0),r.Cars[0].draw(),s.checked&&(t.human=!1,S());else{r.Barrier[0].draw();for(var c=void 0,l=void 0,u=void 0,p=void 0,y=void 0,g=void 0,v=void 0,f=void 0,d=void 0,N=void 0,m=0;m<r.NNs.length;m++)if(void 0!==r.Cars[m]){c=W(r.Cars[m].position,130-r.Cars[m].angle,r.Barrier[0].vectors),l=W(r.Cars[m].position,120-r.Cars[m].angle,r.Barrier[0].vectors),u=W(r.Cars[m].position,110-r.Cars[m].angle,r.Barrier[0].vectors),p=W(r.Cars[m].position,100-r.Cars[m].angle,r.Barrier[0].vectors),y=W(r.Cars[m].position,90-r.Cars[m].angle,r.Barrier[0].vectors),g=W(r.Cars[m].position,80-r.Cars[m].angle,r.Barrier[0].vectors),v=W(r.Cars[m].position,70-r.Cars[m].angle,r.Barrier[0].vectors),f=W(r.Cars[m].position,60-r.Cars[m].angle,r.Barrier[0].vectors),d=W(r.Cars[m].position,40-r.Cars[m].angle,r.Barrier[0].vectors);var w=t.checkpoints[r.Cars[m].checkpointReached%t.checkpoints.length];N=[w[0]-r.Cars[m].position.x,w[1]-r.Cars[m].position.y];var M=r.Cars[m].velocity.x,A=r.Cars[m].velocity.y,k=r.Cars[m].angularVelocity,b=[c/100,l/100,u/100,p/100,y/100,g/100,v/100,f/100,d/100,N[0]/100,N[1]/100,M/10,A/10,k],x=(n=r.NNs[m]).update.apply(n,z([0],b,!1));if(r.Cars[m].steer(x[0]),r.Cars[m].update()||t.timer>t.timerLimit){var R=Math.atan(N[0]/N[1]);e.strokeStyle="yellow",e.lineWidth=2;var P=r.Cars[m].angle-Math.abs(R),B=r.Cars[m].checkpointReached;B+=1/(1+Math.abs(N[0])/100+Math.abs(N[1])/100),B+=1/(1+Math.abs(P)/10),t.fitnessDictionary[m]=B,r.Cars[m]=void 0,Object.keys(t.fitnessDictionary).length===t.simulatedNNs&&C(!1)}else r.Cars[m].draw()}void 0!==r.Cars[0]&&(b=h.apply(void 0,z([c,l,u,p,y,g,v,f,d],N,!1)),x=(a=r.NNs[0]).update.apply(a,z([0],b,!1)),L.apply(void 0,z(z([i.width-100,50,50,c,l,u,p,y,g,v,f,d],N,!1),[x[0]],!1))),L(650,45,100,"Generation: "+t.generationNum.toString());for(var I=0;I<t.checkpoints.length;I++)e.fillStyle="green",e.lineWidth=0,e.fillRect(t.checkpoints[I][0]-t.checkpointSize/4,t.checkpoints[I][1]-t.checkpointSize/4,t.checkpointSize/2,t.checkpointSize/2);T(50,30,i.width-300,i.height-200,r.NNs[0].weightArray,r.NNs[0].biasArray,0),t.timer++,s.checked||(t.human=!0,S())}},(V=function(){O();var i=t.delay;window.setTimeout(V,i)})()})();