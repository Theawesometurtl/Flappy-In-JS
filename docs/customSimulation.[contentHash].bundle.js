(()=>{"use strict";var t={pipeTimer:100,timer:0,simulatedNNs:500,fitnessDictionary:{},NNKeepers:50,NNBrain:[4,8,8,8,6,4,1],bestNNs:{},mousePos:{},mutationRateMutationRate:.3,mutationMutationAmount:2,checkpoints:[[208,208],[489,122],[697,132],[907,196],[920,394],[794,481],[550,494],[350,466],[261,349],[453,292],[580,374]],checkpointSize:50,timerLimit:1e3,delay:20,human:!0,generationNum:0},i=document.querySelector("canvas");i.width=window.innerWidth,i.height=window.innerHeight;var e=i.getContext("2d"),r={Flappies:[],Pipes:[],Cars:[],NNs:[],Barrier:[]},o={};window.onkeyup=function(t){o[t.keyCode]=!1},window.onkeydown=function(t){o[t.keyCode]=!0};var n=document.getElementById("checkbox"),a=document.getElementById("rangeValue"),s=document.querySelector("#range");null!=n&&n.addEventListener("keydown",(function(t){32===t.keyCode&&t.preventDefault()})),null!=s&&null!=a&&(s.addEventListener("change",(function(i){a.innerHTML=s.value+" Simulation Speed",t.delay=20-.02*parseInt(s.value)})),s.addEventListener("mousemove",(function(i){a.innerHTML=s.value+" Simulation Speed",t.delay=20-.02*parseInt(s.value)})));var h=function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];return t.map((function(t){return 1/(1+Math.exp(-t))}))},c=function(t,i,e){if(e||2===arguments.length)for(var r,o=0,n=i.length;o<n;o++)!r&&o in i||(r||(r=Array.prototype.slice.call(i,0,o)),r[o]=i[o]);return t.concat(r||Array.prototype.slice.call(i))},l=function(){function t(){for(var i=[],e=0;e<arguments.length;e++)i[e]=arguments[e];this.neuronsPerLayer=i,this.biasArray=[],this.weightArray=[],t.NNAmount++,this.networkNumber=t.NNAmount,this.biasMutationRate=1,this.biasMutationAmount=1,this.weightMutationRate=1,this.weightMutationAmount=1}return t.prototype.createNeuralNet=function(t){void 0===t&&(t=0),this.biasArray[t]=[];for(var i=0;i<this.neuronsPerLayer[t];i++)Math.random()<.5?this.biasArray[t][i]=1:this.biasArray[t][i]=-1;if(++t!==this.neuronsPerLayer.length){this.weightArray[t]=[];for(i=0;i<this.neuronsPerLayer[t-1];i++){this.weightArray[t][i]=[];for(var e=0;e<this.neuronsPerLayer[t];e++)Math.random()<.5?this.weightArray[t][i][e]=1:this.weightArray[t][i][e]=-1}return this.createNeuralNet(t)}},t.prototype.fullMutate=function(t,i,e){void 0===t&&(t=0),void 0===e&&(e=.01);for(var r=0;r<this.biasArray[t].length;r++)Math.random()<this.biasMutationRate&&(this.biasArray[t][r]+=Math.random()-.5,this.biasArray[t][r]*=(Math.random()-.5+this.biasMutationAmount)/this.biasMutationAmount);if(++t!==this.biasArray.length){for(r=0;r<this.weightArray[t].length;r++)for(var o=0;o<this.weightArray[t][r].length;o++)Math.random()<this.weightMutationRate&&(this.weightArray[t][r][o]+=Math.random()-.5,this.weightArray[t][r][o]*=(Math.random()-.5+this.weightMutationAmount)/this.weightMutationAmount);return this.fullMutate(t,i,e)}},t.prototype.update=function(t){void 0===t&&(t=0);for(var i=[],e=1;e<arguments.length;e++)i[e-1]=arguments[e];if(++t>=this.neuronsPerLayer.length)return i;var r=[];return r=this.updateBiases(t,0,r),r=this.updateWeights(t,0,0,r,i),r=h.apply(void 0,r),this.update.apply(this,c([t],r,!1))},t.prototype.updateBiases=function(t,i,e){return void 0===t&&(t=0),void 0===i&&(i=0),e[i]=this.biasArray[t][i],++i>=this.biasArray[t].length?e:this.updateBiases(t,i,e)},t.prototype.updateWeights=function(t,i,e,r,o){return void 0===t&&(t=0),r[e]+=this.weightArray[t][i][e]*o[i],++e>=this.weightArray[t][i].length&&(e=0,++i>=this.biasArray[t-1].length)?r:this.updateWeights(t,i,e,r,o)},t.NNAmount=0,t}(),u=function(){function t(){this.width=50,this.gapHeight=200,t.numOfPipes++,this.pipeNum=t.numOfPipes,this.position={x:i.width+this.width,y:Math.random()*(i.height-this.gapHeight)+this.gapHeight/2},this.velocity={x:-9,y:0}}return t.prototype.update=function(){if(this.position.x+=this.velocity.x,this.velocity.y+=this.velocity.y,this.position.x<0-this.width){var t=void 0;for(t in r.Pipes)r.Pipes[t].pipeNum===this.pipeNum&&r.Pipes.splice(t,1)}},t.prototype.draw=function(){e.fillStyle="green",e.fillRect(this.position.x-this.width/2,0,this.width,this.position.y-this.gapHeight/2),e.fillRect(this.position.x-this.width/2,this.position.y+this.gapHeight/2,this.width,i.height+1e3)},t.numOfPipes=0,t}(),p=function(){function r(){this.position={x:50,y:i.height/2},this.velocity={x:0,y:0},this.width=50,this.height=50,this.jumpVelocity=21,this.drag=.9,this.gravity=3}return r.prototype.jump=function(){this.velocity.y=-this.jumpVelocity},r.prototype.update=function(){this.position.x+=this.velocity.x,this.position.y+=this.velocity.y,this.velocity.x*=this.drag,this.velocity.y+=this.gravity,this.velocity.y*=this.drag,!0===o[32]&&t.human&&this.jump()},r.prototype.draw=function(){e.fillStyle="yellow",e.fillRect(this.position.x-this.width/2,this.position.y-this.height/2,this.width,this.height),e.strokeStyle="black",e.lineWidth=3,e.beginPath(),e.moveTo(this.position.x-this.width/2,this.position.y-this.height/2),e.lineTo(this.position.x+this.width/2,this.position.y-this.height/2),e.lineTo(this.position.x+this.width/2,this.position.y+this.height/2),e.lineTo(this.position.x-this.width/2,this.position.y+this.height/2),e.closePath(),e.stroke()},r.prototype.die=function(){this.position.y=100,this.velocity.y=0},r}(),y=function(){function t(){this.c=-1}return Object.defineProperty(t.prototype,"count",{get:function(){return this.c++,this.c},set:function(t){this.c=t},enumerable:!1,configurable:!0}),t}();function g(t,i){for(var e=i.length.toString(),r=0;r<i.length;r++)e=e+" "+i[r].length.toString();for(r=0;r<i.length;r++)for(var o=0;o<i[r].length;o++)e=e+" "+i[r][o].toString();for(r=1;r<t.length;r++)for(o=0;o<t[r].length;o++)for(var n=0;n<t[r][o].length;n++)e=e+" "+t[r][o][n].toString();return e}function v(t){for(var i=t.split(" "),e=[],r=0;r<i.length;r++)e.push(parseFloat(i[r]));for(var o=new y,n=e[o.count],a=[],s=[],h=[],c=0;c<n;c++)a[c]=e[o.count];for(c=0;c<n;c++){s[c]=[];for(var l=0;l<a[c];l++)s[c][l]=e[o.count]}for(c=1;c<n;c++){h[c]=[];for(l=0;l<a[c-1];l++){h[c][l]=[];for(var u=0;u<a[c];u++)h[c][l][u]=e[o.count]}}return[s,h]}function f(t,i,e){return Math.random()<t&&(e*=(i+Math.random()-.5)/i),e}var d=function(t,i,e){if(e||2===arguments.length)for(var r,o=0,n=i.length;o<n;o++)!r&&o in i||(r||(r=Array.prototype.slice.call(i,0,o)),r[o]=i[o]);return t.concat(r||Array.prototype.slice.call(i))};function N(t,i){for(var e=0;e<t.length-1;e++)for(var r=0;r<i.length-1;r++){if(m(t[e],t[e+1],i[r],i[r+1])[0])return!0}return!1}function m(t,i,e,r){var o,n=t[0],a=t[1],s=i[0],h=i[1],c=e[0],l=e[1],u=r[0],p=r[1];if(n===s&&a===h||c===u&&l===p)return[!1];if(0===(o=(p-l)*(s-n)-(u-c)*(h-a)))return[!1];var y=((u-c)*(a-l)-(p-l)*(n-c))/o,g=((s-n)*(a-l)-(h-a)*(n-c))/o;return y<0||y>1||g<0||g>1?[!1]:[!0,n+y*(s-n),a+y*(h-a)]}function w(t,i,e){var r=[t,i,e];return r.sort((function(t,i){return i-t})),r[1]===e}function M(t,i){return Math.sqrt(Math.pow(t,2)+Math.pow(i,2))}var A=function(){function i(){for(var i=[],e=0;e<arguments.length;e++)i[e]=arguments[e];this.angularDrag=.85,this.position={x:t.checkpoints[0][0],y:t.checkpoints[0][1]},this.velocity={x:0,y:0},this.angle=0,this.accelleration=.4,this.length=4,this.width=10,this.angularVelocity=0,this.angularAcceleration=3,this.drag=.95,this.vertices=[[this.length,this.width],[-this.length,this.width],[-this.length,-this.width],[this.length,-this.width]],this.vertexCoords=[];for(var r=0;r<this.vertices.length;r++)this.vertexCoords[r]=[],this.vertexCoords[r][0]=this.vertices[r][0]+this.position.x,this.vertexCoords[r][1]=this.vertices[r][1]+this.position.y;this.checkpointReached=0}return i.prototype.draw=function(){e.strokeStyle="purple",e.lineWidth=1,e.fillStyle="white",e.beginPath(),e.moveTo(this.vertexCoords[0][0],this.vertexCoords[0][1]);for(var t=1;t<this.vertices.length;t++)e.lineTo(this.vertexCoords[t][0],this.vertexCoords[t][1]);e.closePath(),e.fill(),e.stroke()},i.prototype.update=function(){this.angularVelocity*=this.angularDrag,this.angle+=this.angularVelocity;var i=Math.PI/180*this.angle,e=Math.cos(i),o=Math.sin(i);this.velocity.x+=this.accelleration*e,this.velocity.y+=this.accelleration*o;var n=M(this.velocity.x,this.velocity.y);if(0!==n){var a=0;this.velocity.y<0?(a=Math.PI,a+=-Math.atan(this.velocity.x/-this.velocity.y)):a+=Math.atan(this.velocity.x/this.velocity.y),n*=this.drag,this.velocity.x=n*Math.sin(a),this.velocity.y=n*Math.cos(a),w(t.checkpoints[this.checkpointReached%t.checkpoints.length][0]-t.checkpointSize,t.checkpoints[this.checkpointReached%t.checkpoints.length][0]+t.checkpointSize,this.position.x)&&w(t.checkpoints[this.checkpointReached%t.checkpoints.length][1]-t.checkpointSize,t.checkpoints[this.checkpointReached%t.checkpoints.length][1]+t.checkpointSize,this.position.y)&&this.checkpointReached++}this.position.x+=this.velocity.x,this.position.y+=this.velocity.y;for(var s=0;s<this.vertices.length;s++)this.vertexCoords[s][0]=o*this.vertices[s][0]+e*this.vertices[s][1]+this.position.x,this.vertexCoords[s][1]=o*this.vertices[s][1]-e*this.vertices[s][0]+this.position.y;for(var h=0;h<r.Barrier[0].vectors.length;h++)if(N(this.vertexCoords,r.Barrier[0].vectors[h]))return!0;return!1},i.prototype.steer=function(t){t>.5?(t=1-t,t=.5-(t=Math.pow(t,2)),this.angularVelocity+=t*this.angularAcceleration):t<.5&&(t=-.5+(t=Math.pow(t,2)),this.angularVelocity+=t*this.angularAcceleration)},i}(),k=function(){function t(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];this.vectors=t}return t.prototype.draw=function(){e.strokeStyle="black",e.lineWidth=5,e.beginPath();for(var t=0;t<this.vectors.length;t++){e.moveTo(this.vectors[t][0][0],this.vectors[t][0][1]);for(var i=1;i<this.vectors[t].length;i++)e.lineTo(this.vectors[t][i][0],this.vectors[t][i][1]);e.stroke()}},t}(),b=function(t,i,e){if(e||2===arguments.length)for(var r,o=0,n=i.length;o<n;o++)!r&&o in i||(r||(r=Array.prototype.slice.call(i,0,o)),r[o]=i[o]);return t.concat(r||Array.prototype.slice.call(i))};function C(i){r.Pipes=[],r.Flappies=[],r.Barrier=[],r.Cars=[],t.generationNum++;var e=function(i){void 0===i&&(i=1);var e=t.fitnessDictionary;t.fitnessDictionary={};var o=Object.keys(e).map((function(t){return[parseInt(t),e[parseInt(t)]]}));o.sort((function(t,i){return i[1]-t[1]}));var n=o[0][1],a=r.NNs[o[0][0]];n>=4&&(console.log(n,a.networkNumber,g(a.weightArray,a.biasArray)),t.bestNNs[o[0][1]]=g(a.weightArray,a.biasArray));for(var s=1;s<t.simulatedNNs;s++)o[s][1]*=(Math.random()+i)/i;o.sort((function(t,i){return i[1]-t[1]})),o=o.slice(0,t.NNKeepers);for(var h=[],c=0;c<t.simulatedNNs/o.length;c++)h.push.apply(h,o);return h}(10);if(function(i){for(var e=[],o=0;o<i.length;o++){e[o]=new(l.bind.apply(l,d([void 0],t.NNBrain,!1))),e[o].createNeuralNet();var n=v(g(r.NNs[i[o][0]].weightArray,r.NNs[i[o][0]].biasArray));e[o].biasArray=n[0],e[o].weightArray=n[1],e[o].biasMutationAmount=r.NNs[i[o][0]].biasMutationAmount,e[o].biasMutationRate=r.NNs[i[o][0]].biasMutationRate,e[o].weightMutationAmount=r.NNs[i[o][0]].weightMutationAmount,e[o].weightMutationRate=r.NNs[i[o][0]].weightMutationRate}r.NNs=[];for(var a=0;a<e.length;a++)r.NNs.push(e[a]);for(var s=0;s<t.NNKeepers;s++);for(a=t.NNKeepers;a<t.simulatedNNs;a++){r.NNs[a].fullMutate(0,.3,.03);var h=r.NNs[a],c=h.biasMutationAmount,u=h.biasMutationRate,p=h.weightMutationAmount,y=h.weightMutationRate;r.NNs[a].biasMutationAmount=f(t.mutationRateMutationRate,t.mutationMutationAmount,c),r.NNs[a].weightMutationAmount=f(t.mutationRateMutationRate,t.mutationMutationAmount,p),r.NNs[a].biasMutationRate=f(t.mutationRateMutationRate,t.mutationMutationAmount,u),r.NNs[a].weightMutationRate=f(t.mutationRateMutationRate,t.mutationMutationAmount,y)}}(e),t.timer=0,i){t.pipeTimer=0,u.numOfPipes=0,r.Pipes.push(new u);for(var o=0;o<t.simulatedNNs;o++)r.Flappies.push(new p)}else{for(o=0;o<t.simulatedNNs;o++)r.Cars.push(new A);var n=JSON.parse(localStorage.getItem("barrier"));console.log(n),r.Barrier.push(new(k.bind.apply(k,b([void 0],n,!1))))}}var x=function(t,i,e){if(e||2===arguments.length)for(var r,o=0,n=i.length;o<n;o++)!r&&o in i||(r||(r=Array.prototype.slice.call(i,0,o)),r[o]=i[o]);return t.concat(r||Array.prototype.slice.call(i))};function S(){t.generationNum=0,r.Pipes=[],r.Flappies=[],r.Barrier=[],r.Cars=[];var i=JSON.parse(localStorage.getItem("barrier"));if(t.human)r.Cars.push(new A),r.Barrier.push(new(k.bind.apply(k,x([void 0],i,!1))));else{for(var e=0;e<t.simulatedNNs;e++){if(r.Cars.push(new A),r.NNs.push(new(l.bind.apply(l,x([void 0],t.NNBrain,!1)))),r.NNs[e].createNeuralNet(0),JSON.parse(localStorage.getItem("preTrained"))){var o=v("8 11 11 13 10 7 6 4 1 0.2124194716570944 0.7587596850798378 -0.9458448734540967 -0.991269727821445 0.508255939817142 -0.347306964866713 -0.3251959871064603 -0.39924212453507474 -1.8253528640540113 -0.6604846493032914 -1.3968954615313507 -1.3714241219019598 -2.293168419406151 -0.40989625978030103 -0.7365644762746555 -0.10842046703744677 -0.28619931707357205 0.6427054621733487 0.532509848815083 -0.15578633926463678 0.2622189112482286 -0.3958906255919528 -0.0032296624884263964 -0.5176412081270888 -0.16636732613477503 3.4986890095353353 0.6284381323307388 1.9256917761808658 0.5360883609982604 -1.2498621348164944 -0.4996369949059474 -0.3235987904684974 -3.2215412825836536 -2.3999182169974285 -0.9377473988186682 0.8500801450418427 -0.7028871339103693 -0.12921186894869974 0.9891268662044327 -1.1686669242605727 2.182421680070706 5.504761678804587 -0.7370605816310168 -2.240241298496449 5.506245736347154 -0.00089421764716359 0.3369052068323679 -4.519972556801193 -2.6368635280582753 -0.6237704261309966 -0.06243788007519542 -0.5245648172899636 0.4137020287271153 1.766880264363234 0.9767902327382871 0.026968891454675042 1.4463366262506794 -0.7121570822656488 -1.3170585690706158 -0.7363111812008887 -0.9755726101367403 1.0826235548933871 0.8347586486481492 0.3335220961892156 0.4478063369844954 -0.22932092084354744 5.267888813770002 -1.6308971601866384 1.5190869476849937 -0.6007173338782285 -4.0601604861154 -1.013523077356375 -0.6658648072954795 1.8858087593285713 -0.605587650408478 0.6484755712846549 1.1333216258661563 -1.4140141802185466 0.6199896572844343 0.24537959659236683 0.10810050001277847 0.5573040412610937 -0.2521876550524271 1.0688927200929994 2.435513275867049 2.12017046156191 -0.5199789283454994 0.2582462613131317 0.06538807193189632 0.5394235491303212 0.6428099060298109 -1.9285444425054243 -0.033067223808539575 -2.030577295398878 -1.0265197904097556 2.191122417390256 0.47336342198931763 -1.4449451787179368 -1.0106917353232567 -0.43456298514539854 -2.529035986189527 -0.01644227394503418 4.9088255351823475 -0.6096928697843202 2.0847934854623444 -4.839241034274081 -0.10670991571061991 -3.164317999198177 -0.00863044086748216 4.547728065960083 -0.23792792027109494 -0.07646822517490087 -0.20510362412568198 0.8522443608951419 -1.430582941706595 -1.744940952362565 -0.4933311433622981 -0.21538160008719884 1.3872484272791432 -0.3874368482199829 -0.18941743868275515 -0.33320621607214246 -0.3956328538381986 1.5977227579979916 0.3814963907288768 1.354616713022217 -0.40002327771818164 -1.5104375240713803 0.23457444646798442 0.35281825811157813 -0.7939560097764506 0.3866575004683293 -2.2722750724170186 -1.256034619289869 0.9229385032386057 -0.003299172641749647 1.6759305163861546 0.33599809613783443 0.6677127376355495 -1.5013190551277293 0.26169113232944624 -0.333588870721613 1.2828711572363596 0.39094394856945053 0.621856461206203 1.286891720758166 -0.1431071398284786 1.2504574119599614 -1.5677272499007568 -0.6403883660183014 -1.300469897542408 1.742226201199463 0.1214776324326657 0.01768310043278096 1.5535734414848652 1.5065757090416745 -0.04715796681241782 0.13573425198758085 1.5904211912877393 1.4115474116496092 1.5043928497568118 -9.69739060485506 -0.7276481370801648 -0.4977431514016882 -1.1603328547158083 1.0941620834888621 0.45602097333580394 3.2859756225936003 -2.099553890344124 0.23789820299260073 0.4365679269743228 -3.274102445637681 1.6199652474163655 -0.6843441472436951 0.1890812932442625 -0.293907573047037 0.04396667799893501 0.5410513603538853 -1.9331914525451754 -0.019250839677887644 1.0587971819006334 1.2282811487897867 0.08731107377880137 -4.9235832510252875 0.8947955462939313 -7.146176241984573 0.270368076494599 0.043081372915541614 -1.2905228499970893 0.07914842251774491 0.48796164526698815 0.32135274707077954 0.484371879283701 -0.09199842662697663 0.4689240841254506 0.107597452777185 1.4479949770545157 -1.2735782473555295 24.82877525043491 -0.24058956301671916 1.0373010096122683 3.5857034191588517 0.37102849627264084 -1.3769728069118308 -0.4381792095114802 1.3310512905090284 -0.5230391012147603 -6.933986866214552 1.4779671791252866 1.388939515493859 -0.849865531815044 2.2232095170786157 0.6321305625901895 -0.2627919177621085 0.9580219634257221 0.7712041768666854 -0.9293134273982349 -1.727897769729253 -0.2440096480765474 -0.19468638191065443 -0.6069960196188268 0.9461671808523382 0.25365842480647405 -0.07440206796562561 1.61577759406534 -0.48001981097199425 0.3024901399132341 -1.6163370298191204 -1.0393078357226004 0.26612635044358735 -3.0212360356239167 1.3064057982255581 3.540831052549915 0.5169316482120114 -0.9948442443412627 -0.27822708902187704 -0.2294675806973037 0.22454248629893736 -0.36235648333283677 -0.3337176484110266 -3.204149096005583 -8.713489110044158 -0.06999357200406706 0.2970193714749282 -2.329963081414771 -0.8549928139924471 -1.1088494103470192 -0.8855269554760649 3.3004845710135977 -3.104839382685737 0.7014609719544378 0.13879867921691333 -0.3187407636727452 1.3108915817262676 -0.4229990380680718 1.2019032763308553 -13.168757005892118 1.319628944164745 -4.483125811675764 2.6456324393879247 -0.22437425857003093 0.799681468922259 -0.07597842409888463 1.0504437019008577 0.9472565566502831 0.8152076428652376 -0.8946928715666067 -1.1421971780458369 -0.23381982334132195 -0.09693233494281342 -0.311208091336759 -0.9187572685956981 -0.21377356628767782 2.3924125155877864 -1.1263086530398245 2.6901960936365197 -0.039967044464916716 -2.86050804680051 4.86766498649464 -1.5627782083352315 -0.9934959915907317 -0.33251316724727076 -0.16338065646274832 -3.362871034962126 -0.2532768989351417 -1.0078984650317009 -0.3752115355868456 1.2996550395264121 -1.4450275240167645 -2.412636014083999 2.316951124049143 0.7732723140130006 -1.1596054793173651 -0.21429274367884088 -0.21834034862846277 1.6723721605120383 -0.7552398003463681 0.6653973626119544 -0.6524707910519729 -0.34864148861138444 -2.1892149546368955 0.516753824219123 -2.2214432063503446 -0.8782519549663564 0.13809885768611013 0.3845559581342205 -2.1766293343036724 0.07722694247892445 2.8566861594608186 -0.920392746557504 0.7931282015403449 -2.0877826128157166 0.9835797709996044 -1.1076185032460841 0.36136942638833647 2.5703504793926744 0.07659779223402649 -0.14681535686102856 0.3270441750417858 6.921481262087245 -1.4777772740096264 -0.28834696622579903 -0.3481024213270431 0.5459671552346348 3.0510352390532876 -0.634964549889158 -1.7854491772650267 -0.27737667591285103 -0.051541769437973305 5.926662341685371 1.9667696578777902 -1.359401532073747 2.3963461641930515 -0.29840936008928 -7.0640576214309005 0.07759694196321136 -1.4978302087222444 -4.69231141370782 1.2728867158734676 -0.28443759811654673 -0.012737412840732844 -0.5196119603501209 -1.3744498807900516 -0.10317109362730303 3.08057164457002 0.4374948399156388 0.7501314373414866 -0.7772236653595933 0.12818742384992118 -1.1215886773883472 -0.8823500718006203 0.8548867514279997 -1.020003035480707 -2.257101249619141 -0.7706604891139041 -0.19809331941048994 -0.8955304956305241 0.7462460967006667 -0.34705555865883353 0.8343387269248508 -1.7673014498047461 -5.140982149725526 1.2427658130297046 0.4689588226088885 1.9119525091729155 -1.7286141207842713 -8.5827872268765 -3.04729305280054 0.11866186831697155 -3.972659477066708 0.1875225766463806 0.42237372323840283 -0.45194546735987506 -0.7328579712490065 1.6182772395802065 1.792263926581135 -0.11682468333879661 0.10071119523751214 1.3522018894810537 0.34053643092482905 1.923971875670552 1.5815991946029608 1.6713708687017732 0.09242481290812612 -1.0818953579234418 -1.6976116924352378 -0.25417317195345884 2.03406804992681 -2.681007579421831 1.2736111529026688 3.6148960546095936 -0.5993248643390447 0.23827751887104137 0.8090231829447264 -0.22914183046854536 -0.2776850724100429 0.3269539662077879 -2.022420579647126 0.15923969898196727 -5.313142652527897 0.555658853372579 5.358198867665213 -15.478908663540137 1.8249705804857597 -1.6573051198131663 0.6172492075483071 -0.39138446640391816 -1.879375168398306 0.9759015929296818 0.5452181900576253 2.449632933098858 1.296215690660749 -0.2018390538142583 0.16092861080558474 1.928343031939288 -0.3822988399431833 1.7546863306622 -0.3745130570444167 0.9753052212815154 2.444791211356008 -3.3607883648108894 0.5658104323273002 -12.282202422999191 0.6146284784877157 1.2301153501101472 -10.442623926591452 -0.36615033751953796 0.865448093525755 -0.24328255680883146 -0.4777500724370389 -0.7319362637339268 -0.777055561995589 0.7393323246783127 0.26818512702747543 -0.5565809626622625 -1.8810666119348798 0.21285114454173687 -0.11262238351456558 -0.08639138194182067 -0.5423423354927229 1.2119889538069382 2.407552086226088 0.1444356353201821 0.15628820678937566 -0.7338512533568632 -0.34869558385582033 1.1909463555237167 0.5703945039811914 0.2817073712036586 -0.7145236367684041 -0.8184101431987917 1.02329273529436 0.03042318369001468 0.003684568928770586 -0.6980501847662377 1.3827074853160384 -3.466639823208428 0.28784473821412254 -1.314057952243228 -0.42458751890603824 1.7287049447839125 -0.686565761756452 1.4900110753959968 1.7978328058346147 -0.2270298537738935 -5.065827153265371 -0.619592976870093 6.346991237893877 5.303512702870454 -0.4843072646389479 0.2411843532715143 2.5649175907056594 -1.1652081684910531 -1.1962964367377074 -1.4280179725379842 -0.19731943536044877 1.4353638177730428 0.5414333439806012 0.4029262843207807 0.42853023452085787 0.14768441823155892 -3.0514990492503187 -0.14278340379273996 -0.020112687678722693 -3.7680253552950296 -1.0492102216327615 -4.1671269533230735 0.9717889153446501 2.864435117889851 0.437497701388496 1.726739216988754 0.4866934543776708 -0.25755806465212017 0.8984115475566788 0.5268177207316854 0.40305476868296997 -1.1505106940175196 0.7312869401249987 0.10963702366443805 -3.2366974687725936 -0.5713540488054689 0.42709608782332825 -0.9135210657816089 -0.0962742445966923 1.6762725355512365 -0.3408238197708363 0.40410691325761905 0.012076498805694955 5.317794187211052 0.5382558446649709 0.08122340197467114 2.225314636188697 1.5130804438140089 0.08523891995637367 0.1778144013527987 -3.571173126641569 -0.05541479716771927 -0.23979217532518032 -2.6705969455351455 -0.828255191100133 0.08879579190645973 -0.7074002092933022 1.2239514933205935 1.2022637078878158 1.5705670133048708 -0.5918584064962122 -4.93486921774159 0.261294383871457 -0.24581427742094186 1.857467477087399 -0.4388990778568087 3.193064606932925 -0.6098520138981773 -2.0013136291775067 -0.2603274783542218 -0.7273496345230829 -0.17297017153490082 -0.006938471917999746 0.43421654647992186 2.379706295888535 2.008110865477354 -0.12261024346088252 4.646871214156608 -0.26506189248747014 0.062313143507835546 -0.3023425618022741 -0.06093224649827973 -0.9034922590718293 0.08291908262814045 0.15226500750040034 2.690812252560493 3.4469771897124493 -0.43613571478448354 -1.2978098440726225 -0.8396179930330191 -2.531441877856738 -0.8497193189149063 0.6989721690099907 -0.34462907918878255 1.0677532298588386 1.2642882974941454 -0.6192118402088401 -0.19547891059616598 -0.19366924994259252 0.21211119144388743 1.3139424726304496 1.0767508626219553 -0.9490688386582822 -0.07392793098036077 0.5399321261577045 0.6034456125354678 2.0868295268041055 0.06263072652928849 -1.3530926098759273 -0.025398611321992188 -0.170910323387582 1.807553217719922 0.7355890251725549 -0.17634743762905758 -0.013702207832713708 0.9874280433986413 -0.3481819807635115 -2.1415624128642317 0.417705689721232 -0.5195914971049209 0.08297840117992274 0.38446581106265726 -3.0507262575844405 -1.1868639577145248 0.048367519496259836 -4.928451400887299 -0.6767452217010722 1.9621157818704944 -1.9887608549412281 0.7281073182924002 -3.389448176422194 0.3523012351525495");r.NNs[e].biasArray=o[0],r.NNs[e].weightArray=o[1]}t.fitnessDictionary[e]=e}C(!1)}}function R(t){var i=t.toString(16);return 1==i.length?"0"+i:i}function P(t,i,e){return"#"+R(t)+R(i)+R(e)}function B(t,i,r,o,n,a){e.beginPath(),e.arc(n,a,t,0,2*Math.PI,!1),e.fillStyle=i,e.fill(),e.lineWidth=o,e.strokeStyle=r,e.stroke()}function T(t,i,r,o,n,a,s){if(void 0===s&&(s=0),function(t,i,e,r,o,n){void 0===n&&(n=0);for(var a=0;a<o[n].length;a++)I(o[n][a]),B(9,I(o[n][a]),"black",3,n*t+e,a*i+r)}(t,i,r,o,a,s),++s!==a.length)return function(t,i,r,o,n,a){void 0===a&&(a=0);for(var s=0;s<n[a].length;s++)for(var h=0;h<n[a][s].length;h++){var c=n[a][s][h],l=I(c=Math.round(c));e.strokeStyle=l,e.lineWidth=1,e.beginPath(),e.moveTo((a-1)*t+r,s*i+o),e.lineTo(a*t+r,h*i+o),e.stroke()}}(t,i,r,o,n,s),T(t,i,r,o,n,a,s)}function I(t){return t<0?P(255,t=225-100*t,t):P(t=225-100*t,255,t)}function L(t,i,r){for(var o=[],n=3;n<arguments.length;n++)o[n-3]=arguments[n];e.font="30px Arial",e.fillStyle="white";for(var a=0;a<o.length;a++)e.fillText(o[a].toString(),t,i+a*r)}function W(t,i,r){var o,n=1e4;i=i*Math.PI/180;for(var a=[t.x+Math.sin(i)*n,t.y+Math.cos(i)*n],s=n,h=[a[0],a[1]],c=0;c<r.length;c++)for(var l=0;l<r[c].length-1;l++)(o=m([t.x,t.y],a,r[c][l],r[c][(l+1)%r[c].length]))[0]&&M(o[1]-t.x,o[2]-t.y)<s&&(s=M(o[1]-t.x,o[2]-t.y),h=[o[1],o[2]]);return e.strokeStyle="red",e.lineWidth=.1,e.beginPath(),e.moveTo(t.x,t.y),e.lineTo(h[0],h[1]),e.stroke(),s}var O,z,D=function(t,i,e){if(e||2===arguments.length)for(var r,o=0,n=i.length;o<n;o++)!r&&o in i||(r||(r=Array.prototype.slice.call(i,0,o)),r[o]=i[o]);return t.concat(r||Array.prototype.slice.call(i))};t.checkpoints=JSON.parse(localStorage.getItem("checkpoint")),t.NNBrain=[11,11,13,10,7,6,4,1],S(),O=function(){var n,a;e.fillStyle="#af73b1",e.fillRect(0,0,i.width,i.height);var s=document.getElementById("checkbox");if(t.human)!0!==o[65]&&!0!==o[37]||r.Cars[0].steer(0),!0!==o[68]&&!0!==o[39]||r.Cars[0].steer(1),r.Barrier[0].draw(),r.Cars[0].update()&&(r.Cars[0].position={x:t.checkpoints[0][0],y:t.checkpoints[0][1]},r.Cars[0].velocity={x:0,y:0},r.Cars[0].angle=0,r.Cars[0].angularVelocity=0),r.Cars[0].draw(),s.checked&&(t.human=!1,S());else{r.Barrier[0].draw();for(var c=void 0,l=void 0,u=void 0,p=void 0,y=void 0,g=void 0,v=void 0,f=void 0,d=void 0,N=void 0,m=0;m<r.NNs.length;m++)if(void 0!==r.Cars[m]){c=W(r.Cars[m].position,130-r.Cars[m].angle,r.Barrier[0].vectors),l=W(r.Cars[m].position,120-r.Cars[m].angle,r.Barrier[0].vectors),u=W(r.Cars[m].position,110-r.Cars[m].angle,r.Barrier[0].vectors),p=W(r.Cars[m].position,100-r.Cars[m].angle,r.Barrier[0].vectors),y=W(r.Cars[m].position,90-r.Cars[m].angle,r.Barrier[0].vectors),g=W(r.Cars[m].position,80-r.Cars[m].angle,r.Barrier[0].vectors),v=W(r.Cars[m].position,70-r.Cars[m].angle,r.Barrier[0].vectors),f=W(r.Cars[m].position,60-r.Cars[m].angle,r.Barrier[0].vectors),d=W(r.Cars[m].position,40-r.Cars[m].angle,r.Barrier[0].vectors);var w=t.checkpoints[r.Cars[m].checkpointReached%t.checkpoints.length],M=[c/100,l/100,u/100,p/100,y/100,g/100,v/100,f/100,d/100,(N=[w[0]-r.Cars[m].position.x,w[1]-r.Cars[m].position.y])[0]/100,N[1]/100],A=(n=r.NNs[m]).update.apply(n,D([0],M,!1));if(r.Cars[m].steer(A[0]),r.Cars[m].update()||t.timer>t.timerLimit){var k=Math.atan(N[0]/N[1]);e.strokeStyle="yellow",e.lineWidth=2;var b=r.Cars[m].angle-Math.abs(k),x=r.Cars[m].checkpointReached;x+=1/(1+Math.abs(N[0])/100+Math.abs(N[1])/100),x+=1/(1+Math.abs(b)/10),t.fitnessDictionary[m]=x,r.Cars[m]=void 0,Object.keys(t.fitnessDictionary).length===t.simulatedNNs&&C(!1)}else r.Cars[m].draw()}void 0!==r.Cars[0]&&(M=h.apply(void 0,D([c,l,u,p,y,g,v,f,d],N,!1)),A=(a=r.NNs[0]).update.apply(a,D([0],M,!1)),L.apply(void 0,D(D([i.width-100,50,50,c,l,u,p,y,g,v,f,d],N,!1),[A[0]],!1))),L(650,45,100,"Generation: "+t.generationNum.toString());for(var R=0;R<t.checkpoints.length;R++)e.fillStyle="green",e.lineWidth=0,e.fillRect(t.checkpoints[R][0]-t.checkpointSize/4,t.checkpoints[R][1]-t.checkpointSize/4,t.checkpointSize/2,t.checkpointSize/2);T(50,30,i.width-300,i.height-200,r.NNs[0].weightArray,r.NNs[0].biasArray,0),t.timer++,s.checked||(t.human=!0,S())}},(z=function(){O();var i=t.delay;window.setTimeout(z,i)})()})();