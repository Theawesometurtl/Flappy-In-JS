import { entityList, globals, canvas } from "../../sharedGlobals";
import { NN } from "../classes/NN";
import { simulationReset } from "./simulationReset";
import { drivingGame } from "../drivingGame";
import { Car } from "../classes/Car";
import { Barrier } from "../classes/Barrier";
import { decodeNetwork } from "./encodeDecode";
import { setDynamicInterval } from "./setDynamicInterval";




export function drivingStart() {
    globals.generationNum = 0;
    entityList.Pipes = [];
    entityList.Flappies = [];
    entityList.Barrier = [];
    entityList.Cars = []; 
    const barrier: number[][][]= JSON.parse(localStorage.getItem("barrier"));
    if (globals.human) {
        entityList.Cars.push(new Car());
        entityList.Barrier.push(new Barrier(...barrier))

        // entityList.Barrier.push(new Barrier([[120,309], [162,163], [256,69], [534,43], [852,57], [975,129], [1000,232], [1020,386], [975,489], [889,561], [592,597], [381,555], [216,513], [155,436], [118,305], [336,223], [532,202], [655,212], [819,244], [875,312], [840,382], [755,410], [566,425], [429,425], [368,399], [577,309], [662,309], [208,208], [489,122], [697,132], [907,196], [920,394], [794,481], [550,494], [350,466], [261,349], [453,292], [705,253], [770,334], [580,374],]))

    } else {
        // entityList.Barrier.push(new Barrier([217,64], [362,41], [565,34], [770,33], [889,47], [1075,61], [1229,63], [1296,109], [1329,138], [1368,213], [1373,296], [1374,379], [1349,467], [1325,570], [1282,609], [1196,612], [975,623], [799,597], [532,589], [405,584], [273,560], [126,477], [109,394], [90,273], [112,189], [222,61], [111,187], [89,269], [104,362], [253,283], [319,191], [483,180], [688,153], [833,157], [1016,197], [1142,249], [1193,302], [1124,393], [996,406], [803,429], [647,426], [516,417], [439,394], [171,237], [295,124], [419,105], [554,99], [675,93], [828,94], [1029,113], [1201,174], [1272,280], [1276,408], [1164,480], [961,499], [843,495], [638,497], [500,495], [365,462], [277,386], [421,267], [610,270], [731,271], [875,284], [1044,293]));
        // entityList.Barrier.push(new Barrier(...barrier))
        // console.log(entityList.NNs[0].weightArray);
        for (let i = 0; i < globals.simulatedNNs; i++) {
            entityList.Cars.push(new Car())
            entityList.NNs.push(new NN(...globals.NNBrain));
            entityList.NNs[i].createNeuralNet(0);
            // let brain = decodeNetwork('7 4 8 8 8 6 4 1 -0.13719220917595898 -1.1194268779390801 6.696097411632826 1.9499970741204367 -1.2958397774204606 0.62672047822188 -5.251533877838209 -0.0032549338828420653 -1.6901930538233993 -0.2588694937233665 0.8412890671880321 -2.7050153837500654 4.620869460280591 0.7217298351966643 0.17109395514340253 0.09127773952020092 0.2756211056558732 0.17555978047362977 -1.551425929924325 -0.7476164539767264 -0.06599285340597796 -0.09803459196096437 0.6904234995374405 0.3888804137216944 -0.184361590612881 -0.30695280431850597 -0.35141230181033084 5.023618578454072 1.103547772032302 -1.4290673055996497 0.9053348741541288 0.8578864540633563 -0.1564962249934434 3.422904897767449 -0.5803318011791656 -0.09932561732029098 0.5574362993674784 -0.8597888606311122 0.8014529369824437 0.5722299471304211 0.22951718926030099 1.3304540460212286 0.14304789786788344 -0.5839684904306875 0.7554591224375479 0.06955504680647696 0.2535276208439975 0.14220365057625328 1.5140055865780726 -0.5778089200525539 0.06580902255462519 -2.313490700861579 -0.06811833800774472 -0.5808757281512698 -0.1265920483202893 0.4934716254965657 -1.1880423154641273 2.2811359655003525 -1.451902139073642 0.07819650871015708 -6.105245451167958 -0.1324072673989869 4.615936498606452 -0.5467649002582826 -0.363990505844579 -0.13650389941538213 0.2752074271707381 -0.3338655170036476 2.9487780193088717 0.40019821287813795 4.117986003148169 -0.026780959863113973 -1.1101917759188504 -0.23498474453383608 -1.3228632798048785 -2.354262419036712 0.24308420750931362 -0.1645818411419609 -1.4437550922892162 2.8941579875924344 0.2558467956036607 -0.08814459780887136 0.07087471383894861 2.267507278497597 0.031031443922044502 2.0854726459304396 -0.21733283625573724 -0.1999819336344184 -1.2599866554388457 -0.6871966470843829 1.2455147633396286 -6.526568175634388 1.0307782621458168 -7.048425872433805 0.600579116169935 0.2504273897566358 -0.09427408745581874 -0.33465465162859115 -0.32308019811531374 -3.2159980190640893 -0.16908430382433298 2.0067478951264635 -0.22150819000851285 -3.161536253245908 -7.822592146183477 -0.2632029546935608 0.20856390088984353 -0.22587124732303063 3.1985033387556667 0.01901510816848335 1.281960882048975 -0.6101326365447916 0.4066794227871143 0.032749370204041846 0.580749212327569 0.020218605304891224 6.102399767840279 0.5403363351368605 -1.8743004829536034 0.9134016819901375 0.31985540246334 0.31610311325584417 -2.9528052359256196 -0.16821194217868546 -0.3270534216716528 0.25430533868517585 0.039953323272309695 0.5129078864175823 -1.0878582947501119 -3.0006443577337114 14.482635959067574 -2.205866485139602 2.7404762721349303 1.7497671894086355 0.9583198636903864 -0.013949195263217617 -0.14315511662414362 -0.4397927522661131 -1.3577501945701076 -0.8037514701853001 -2.532449030688125 0.20338491560072233 -0.4507899161410843 -2.2274339272979184 -0.8647814586351603 0.11184881058792277 -0.22822736718419911 -1.9544104517925607 4.48881498689881 -0.015070123006925666 0.23803318676770988 -0.4676579075702204 4.762046592567611 -1.065157665518599 0.36698649976607184 -1.5879018789144397 0.20002589482689223 -9.041748409257522 -2.2672525020911616 -0.9345114241516673 -3.4811402951716857 0.022063383481803863 0.2059936460595231 -0.35740396629588805 -2.3699239112771893 -1.027495575748089 -0.5996610497575394 -0.12186993995018584 -0.8240663689794188 -1.2999587839357876 -1.9482074149323636 -1.4927417583631173 -3.1211408918927446 1.48027679829537 3.8191195438135566 0.25980925939836114 0.19006342230271714 0.499530598113595 2.4391044095659065 -0.1176207064475447 2.174703713289498 0.9217790529193932 0.2625844764234777 0.06777408551092733 -2.0872472586208257 -2.8122299430939925 -0.403084920900534 -1.4024672072477558 4.845740592451458 0.5036364915196372 1.5426561911817338 -0.3821305320163758 3.6832726290129956 0.480329624070939 -1.985249587507281 0.7889348801484201 -0.40341887738958343 -0.25915722889705617 1.3435106810331616 0.05568610322559019 -0.4549430423844065 -0.007186081549999131 0.7489207834255752 0.45978050583417834 -0.6568806714228086 -0.10495150118059714 0.06218937626306283 0.3547073733461225 0.6833622242523779 -0.4741583573543017 -0.54401128181521 -0.2867410499528524 -0.161017511036551 -6.024143323470697 0.23118278365856362 1.314777099100193 -0.030581536631722805 -7.665897662827148 -0.06957086223406536 -3.126610315641824 -0.3664874835156559 0.08952693783212654 -0.40142456191898224 -0.9760336314051915 -4.0331730406373465 0.5506756694354595 0.05767685896761133 -0.5353456205186418 -0.4170011099740233 0.17264469127434132 -0.3778222189272209 0.139728841521226 -0.055037478538710334 -0.22315604973054257 2.647906952538418 1.292665427457963 -0.06918049451020476 -0.6081817884918073 -0.15496785586286013 -0.2510473623856085 -1.0148718285446956 -1.3523704462743185 -7.271101640737253 0.3461364851325806 0.6720616629669748 -0.16919546580714218 -0.11119618680210956 0.08901327960328412 4.02155343660051 -0.07825219503193623 0.8172067821747365 -1.30395355090693 -6.200558542244187 0.25678308078120987 -0.981293711063376 1.4168019953398936 0.09966926060544423 -14.671767000302156 0.009571147677278432 0.6347082481436137 -1.8843019425461434 -0.9723801053668709 -0.8685414978482838 -11.677441636572498 -0.08477232295914232 0.5644398299969121 -0.013559337551321342 1.7044892059684662 -0.018806745957084366 0.44753191570877887 -3.7704113159587465 -0.20838856291620889 0.27172289627818347 -8.441462041682742 -0.07899501613127134')
            let brain = decodeNetwork('8 11 11 13 10 7 6 4 1 0.18444011953203093 0.44079691552572337 -0.48541109231859114 0.11364781813174897 -0.8546986046742943 0.8472891229924268 -0.4977496048025539 -0.06847183733943593 -0.3900000475418346 -0.014503297006342262 -0.8464946965050024 -3.43572458390291 -0.9370956643806421 -0.15668358354243858 -0.72016574449608 -0.23625617364060264 0.26459255439072843 1.34527558053456 0.1788090951429419 -0.4686790851796204 0.5519038360235865 -0.682665258159731 -0.5344759015448289 -1.0316527885016684 -0.8599004197919564 1.3030809416506857 0.8504410011253773 2.3158385508355224 0.3785007946158179 -0.6913746109379791 -0.19749789901734194 -1.1357070634523263 -1.5668602891680057 -0.6508937689835274 -1.2257719517833043 1.0028257065830917 -0.5958965443287669 -0.4657268207911428 0.3133268144566244 -0.7045942964499101 0.9063343101428007 3.5926854763063227 -1.064064999193817 -1.0433520784813428 3.310380324945224 -0.21221669080735528 1.210422730380119 -2.2154857033124475 -2.2034082362936447 -0.4610393023977527 0.3607737142134901 -0.06754443678197765 0.41174456736119197 0.1882520623729885 2.2065388482636985 -1.683571059287796 0.24092425758308528 0.348445781031243 -1.9097850744907974 -1.509087205822822 -0.657153892900263 -0.7719951977296045 1.4042049049257044 0.6482188723266159 -0.40817313016781764 -1.3903610459616114 2.3488698981287417 -0.5604164301385524 0.5191482309789067 -0.43283767402958423 -2.0135047340450165 -1.4682901243785251 -1.2583177382736923 2.9339193787127757 0.24573209837836443 0.19112583868920896 1.9022942376541891 -0.9404895427047811 -1.4911479059803507 -0.568595986543125 -0.5910632236463331 1.7484539567524338 -0.45102205981293536 0.6617014365912639 1.3608889645188458 1.0330110960692411 0.8550319012631867 0.3593027553748627 0.43766431299451225 0.3890462095146751 2.035519891024445 -1.3147081228693376 -0.5562913462266766 -0.3524219973538242 -0.7749149383111454 1.6985131942758755 -0.6769113117470642 -1.5627963088143257 -1.7122389751431968 -1.5019938859559818 -1.3746600244011171 0.6869683570101851 3.895949413704206 -0.4376248157964195 0.8839274314794529 -2.2966502876871773 -0.9370338784197618 -1.6329600088061151 -1.421955932824322 3.207162535984625 0.3397410962600237 0.26413144885956763 0.18133412019531045 0.5355735895717894 0.10941950849226176 -0.9029120583815764 -0.19510968528036493 -1.8087590584312925 0.539604898772778 -0.04867031813725799 -0.21170796193732863 -1.3131919104107435 -2.8879798170176687 2.7818848676089596 0.7430920659740747 -0.300830006665837 -0.4373019971540142 -1.0880196422005401 -0.19612642238302694 1.519017390688118 0.37831589392380016 0.07817561278292573 -3.414280939192217 -0.4337850292554506 -0.13006497090973362 1.1294184723814502 0.9593320088168139 -0.07381740767370382 0.01711608005562195 -1.0358375064731553 0.9521387703571649 -0.394256364506974 0.7850042722396979 1.1000954963106173 -0.1929292063588539 0.8953810235996987 -0.44121466223553196 0.9885981386214748 -1.3765994093626837 0.49916533676056146 -0.652131807210856 2.6322531979563806 -0.6587811499221312 0.2111737137704879 0.9126176980434697 3.2029414379172727 0.3372106341845115 -1.2850763520002946 3.4827019405612654 0.213614048421648 1.2178654525167207 -2.1913070221204043 -0.10757122550015699 0.2796931167681914 -0.4117088323801506 -0.39963470808890783 0.8106288877777122 1.112682789192041 -2.461147739023482 -1.03735815515631 1.3482673224291386 -5.3237497889399545 1.0133376167508459 -1.138954965988356 0.2525744300909589 0.13409327309514688 -0.9757014940508973 0.4881562009366622 -0.7477764135088009 1.5991344253440207 3.89887935626234 0.8435930433925535 0.9876443160251501 -1.3559594675780706 1.4593635042077124 -2.8096085421065173 -0.5071774274774352 1.15680060435748 -0.8695239552774938 0.10512986488390934 -0.18104329322244356 -0.9991643059913716 0.5748965972379854 -0.3782946204754419 2.2728001509062503 0.04687802932930708 0.8827846160531769 -0.12398556049974738 10.617853339667736 -1.9051286337521744 0.5157779497023014 1.1749020182794685 -0.46838394453661203 -0.08117389931899836 -0.48345107200967435 0.7605178924272477 0.8744206432115167 -1.9334851534816764 0.9515582291306801 1.7399897983978145 -0.8224466983365324 3.065589373098533 1.097146807480369 0.8192774923571592 1.614478535866265 1.1865262591214114 -0.9215612470674077 -0.8817474474398671 1.3666012671747991 -0.8583584712115563 1.006763999568485 0.21676992398266567 0.664579979034315 1.4570435287688177 2.3537035161706674 0.49966791581237985 1.002972472105118 -2.006387994051721 -0.4313411916804566 -0.4134771398227924 -0.8721922980309265 1.79716552155451 1.8743078839343195 0.6145525328622169 0.34914128859988036 -0.9579806811418873 0.10354776915995582 0.9621765551429616 0.206776895296754 -0.24738599536282038 -1.568548505129419 -2.1245704034379136 -0.4735188471168648 -0.9021072987520712 -2.8588689486498207 -1.996209663992519 -1.4266897357053558 -0.40898926591327484 0.15689495905153983 -1.4963811430694671 -0.22430238017531978 0.9524350415641862 -0.09741206994564014 1.5898407668449042 -0.1851934839589086 1.9398326189148238 -2.4581321665684768 0.4356485403330907 -0.17660176899938496 0.4503119166514963 -0.7507108157374652 0.9366777947951773 0.187482598522902 0.6107893396110444 0.8860253498257428 0.1852814206109593 -1.3581877720428084 -1.0274000768938982 -0.7258523845500229 -0.7805823314502819 0.6352911890023865 -3.1736924451685193 0.35649610787992314 1.8726844757796908 -1.1033303648107013 1.1578927722963805 0.35461098028600135 -1.1565418964658336 1.2416383223809921 -1.1154877967540955 -0.43345799876723484 -0.01369721281086928 -0.017468112077589516 -1.57934893201669 0.6879953789886718 0.027234788511278255 -1.263941220260452 0.4605350451188406 -0.7412301163638422 -0.3957218371758218 4.421580180813652 1.490574480197851 -0.43306685615691254 -1.7418582364188244 0.9321625870064463 0.5740604112912381 -0.9357209372335358 0.994302055561304 -0.47710803585584954 0.4408249693728732 0.20998395468011144 0.11229572317216477 -2.596867352996895 0.24951078941003416 1.986035686408249 1.9645404134693896 -0.34376004145433886 -0.8706227762192694 1.601604012092127 -0.2916863864027694 -1.036228554444579 -0.7243751985071092 -0.29417506347374656 0.2863803703233493 2.0982968604983903 2.281728907035067 0.6420910759715391 -0.8518510213704954 0.009372412375650044 2.4703973220790085 -0.755926643814419 0.011375621008836094 0.9790096545110255 3.2670642302399067 1.440166743650442 -0.7534310483656264 -2.119992738506496 -0.31684344738565356 -0.3912886581215396 1.86807846959207 1.4469283556674462 -2.1956231205025887 1.1934584722742398 -0.17893710091050538 -4.117685871399106 0.09847876190090903 0.17642760573641378 -3.0112058624481106 3.546051677822972 -0.5056843405157818 0.6044372793431518 -0.9682348348363394 -3.3932901020900017 0.4617161312240934 0.41283567376013475 -0.2074229859967045 0.006995600300427421 -2.035482246901073 -0.7047840499698756 -1.029583725738048 -0.6830962872194023 0.013650062391272765 -0.1871320268976092 -2.9161186658704072 0.1783552516265692 -0.45678506054498286 -0.4272217155638369 -0.9852125377609572 -1.2010251401159808 0.4124764284379996 -0.09315376471128081 -1.0049031175282988 1.9624865066033048 -0.16435902307244468 2.8597196338719315 -1.5143533645977587 -1.6602415682364335 -1.40267690981174 -0.04410765944138791 -4.233566694443635 -0.3863686719099183 -0.16883044334040864 1.8236406211278797 -0.8901768685564952 0.9097914877835553 1.378001832436867 -0.4258231732043744 0.38311162443671093 2.0659639384677386 0.015384762838941685 4.321403046642777 2.1241048037502015 -0.3095594971622133 1.86176207740525 -1.0796254136187515 -0.6013027024189287 -1.791188845650382 0.7670595507259804 -0.5290344820847588 0.6964941061202452 0.14593100454891 0.5616336149105812 0.34007029855077203 0.08320546545090174 0.6399553157879511 0.08882638096544218 -0.7075137109548733 -1.1918845937389484 1.0495903320021793 -0.34345211192732894 -0.06868348109302237 3.6278430612056773 -3.305049471384478 0.39670284485970103 -0.5754333729834443 1.0354708278995834 0.5156862032917522 0.0295915710191131 0.4098999119496885 0.4189659736702776 1.7496910555918705 0.8192240001573879 -0.6026143925917439 0.4526430374504497 -0.059132416879793176 1.1390825190502047 1.8634856962496453 -1.1017013084257357 0.09336521034520354 2.7565224124964667 -0.6826105780287312 0.8752698831386461 -2.2605874116919287 1.1972587231672036 -0.8931294740383632 -1.7746493872346691 -0.53429017560873 1.6325681123631015 -1.5055134091802667 -1.5708226614244385 0.6178798354175579 0.5674382414029585 0.13837998505741192 -0.1609615772377769 0.24739391765517055 -0.34511047120067234 -0.9593734733542968 -0.11501274060668246 0.9382876930015527 -0.44515505071302264 1.5947032064544326 2.633342918112548 -0.2232973976301641 0.18885232845484215 -1.6984986287299555 -0.47578084187682973 -0.2399357741898154 0.8261933326783207 0.5553222570378125 -0.8059429452976512 0.769691749523326 0.6044748580327167 0.022611146151592813 1.2716475880412266 -2.4391295127992922 0.9289440180205774 -3.8150271693360303 -0.5187413751093388 -1.5863469726496107 0.041736035321770205 1.8640028201102123 -1.3665186129458182 0.9739284639328981 1.3177656852398962 0.4652154782277979 -3.9479571388447607 0.3246060486515951 2.602964532960928 2.1958057562518083 -0.9347441595406488 -0.12711575014639254 -0.39050429343387644 0.18694882197378637 -0.5200724800774729 -0.6538329553727072 -2.6939209096256658 2.781836504794737 0.150147287025605 -0.5559543270919568 0.5970474925475631 0.5879616852905277 -3.6018177802700833 -0.2718549896165334 -0.7151264100787429 -0.3999238364170291 -2.200997129052997 -0.7491180029979985 0.624259844604796 1.8440345935595828 2.013268240689824 0.7064786648930617 0.5103983552709493 -0.23575829359538802 1.6790350201985955 -0.4146477761823999 2.337448880945321 0.031489915226183766 1.1455022695367725 0.04681318418800359 -3.1521388847646947 0.049732803898706976 -0.758034336261015 -0.7498202857802608 -1.2052090308489471 0.37055367887323604 -0.6450844073861741 1.3480999428226286 -0.053912463256219866 2.887467235350508 0.06828603791907557 0.8391354204017666 0.7779462779635692 -0.5830592237047784 0.045015429148290785 0.7469813506588091 -1.648454342379557 -0.2815071582191255 -0.1718406446892407 -2.0436339299741175 -0.5490756470059946 1.6926473206328745 0.9001171287681236 0.895919925422372 1.6939184273645684 0.5634433606555117 0.004438334051254131 -2.625561650851385 0.14750726768536448 -0.4855007438359559 1.6314207147538176 -0.5167490795081788 1.5120938599641414 -0.08498859882590347 -1.520356251611273 -1.287970162884596 -0.6451195764388562 1.6252822251089045 -1.9216872288768354 0.10751172414417803 2.454605524391202 6.174941136851044 -0.26891403026899247 0.32947717380684427 -0.639109575611268 -0.6152608479280502 0.0034828186310077724 -0.6799462513463658 -0.33439184880946465 1.5221548951670418 0.07996667761446431 2.4095586546704393 0.5537484288725825 -0.6373814533607944 -0.41787120165032243 -2.2320876108196734 -1.0169187956527403 -0.4637838841689425 -0.8870565468233677 -0.36507223205152856 3.6156865611128164 0.5358562944213866 -0.31031112939886646 -1.2721934447501393 -1.523180120980794 0.745607320515584 0.7176349201905555 1.1810157706373265 -1.2007003166786043 -0.30777681995671513 2.9314128519135805 0.13296368269603182 1.3932187395146503 1.1231095507720128 -0.6958833499342006 -0.7911059301915013 0.7682178040617066 0.134038515948816 0.43919814899117765 0.7940851810432278 1.0206702482838321 0.6639294515630686 -1.0316057205892417 -2.2107180597994542 -0.7086589518645792 -1.2993396567020261 0.04020173423580426 0.09428469779906688 -0.8908998178182108 -1.6007695084117488 -0.6556398941408201 -0.7477333499751937 -0.5810826125622348 0.0027549831467720332 -0.9286952854621848 0.03810222555107317 -1.103698432738391 -0.6651178633023435')
            entityList.NNs[i].biasArray = brain[0];
            entityList.NNs[i].weightArray = brain[1];
            entityList.NNs[i].fullMutate(0, 10, 0.1);

            globals.fitnessDictionary[i] = i;
        }
        simulationReset(false);
    }
    
}