import { entityList, globals, canvas } from "../../sharedGlobals";
import { NN } from "../classes/NN";
import { simulationReset } from "./simulationReset";
import { drivingGame } from "../drivingGame";
import { Car } from "../classes/Car";
import { Barrier } from "../classes/Barrier";
import { decodeNetwork } from "./encodeDecode";
import { setDynamicInterval } from "./setDynamicInterval";




export function drivingStart() {
    globals.generationNum = 0;
    entityList.Pipes = [];
    entityList.Flappies = [];
    entityList.Barrier = [];
    entityList.Cars = []; 
    const barrier: number[][][]= JSON.parse(localStorage.getItem("barrier"));
    if (globals.human) {
        entityList.Cars.push(new Car());
        entityList.Barrier.push(new Barrier(...barrier))

        // entityList.Barrier.push(new Barrier([[120,309], [162,163], [256,69], [534,43], [852,57], [975,129], [1000,232], [1020,386], [975,489], [889,561], [592,597], [381,555], [216,513], [155,436], [118,305], [336,223], [532,202], [655,212], [819,244], [875,312], [840,382], [755,410], [566,425], [429,425], [368,399], [577,309], [662,309], [208,208], [489,122], [697,132], [907,196], [920,394], [794,481], [550,494], [350,466], [261,349], [453,292], [705,253], [770,334], [580,374],]))

    } else {
        // entityList.Barrier.push(new Barrier([217,64], [362,41], [565,34], [770,33], [889,47], [1075,61], [1229,63], [1296,109], [1329,138], [1368,213], [1373,296], [1374,379], [1349,467], [1325,570], [1282,609], [1196,612], [975,623], [799,597], [532,589], [405,584], [273,560], [126,477], [109,394], [90,273], [112,189], [222,61], [111,187], [89,269], [104,362], [253,283], [319,191], [483,180], [688,153], [833,157], [1016,197], [1142,249], [1193,302], [1124,393], [996,406], [803,429], [647,426], [516,417], [439,394], [171,237], [295,124], [419,105], [554,99], [675,93], [828,94], [1029,113], [1201,174], [1272,280], [1276,408], [1164,480], [961,499], [843,495], [638,497], [500,495], [365,462], [277,386], [421,267], [610,270], [731,271], [875,284], [1044,293]));
        // entityList.Barrier.push(new Barrier(...barrier))
        // console.log(entityList.NNs[0].weightArray);
        for (let i = 0; i < globals.simulatedNNs; i++) {
            entityList.Cars.push(new Car())
            entityList.NNs.push(new NN(...globals.NNBrain));
            entityList.NNs[i].createNeuralNet(0);
            // let brain = decodeNetwork('7 4 8 8 8 6 4 1 -0.13719220917595898 -1.1194268779390801 6.696097411632826 1.9499970741204367 -1.2958397774204606 0.62672047822188 -5.251533877838209 -0.0032549338828420653 -1.6901930538233993 -0.2588694937233665 0.8412890671880321 -2.7050153837500654 4.620869460280591 0.7217298351966643 0.17109395514340253 0.09127773952020092 0.2756211056558732 0.17555978047362977 -1.551425929924325 -0.7476164539767264 -0.06599285340597796 -0.09803459196096437 0.6904234995374405 0.3888804137216944 -0.184361590612881 -0.30695280431850597 -0.35141230181033084 5.023618578454072 1.103547772032302 -1.4290673055996497 0.9053348741541288 0.8578864540633563 -0.1564962249934434 3.422904897767449 -0.5803318011791656 -0.09932561732029098 0.5574362993674784 -0.8597888606311122 0.8014529369824437 0.5722299471304211 0.22951718926030099 1.3304540460212286 0.14304789786788344 -0.5839684904306875 0.7554591224375479 0.06955504680647696 0.2535276208439975 0.14220365057625328 1.5140055865780726 -0.5778089200525539 0.06580902255462519 -2.313490700861579 -0.06811833800774472 -0.5808757281512698 -0.1265920483202893 0.4934716254965657 -1.1880423154641273 2.2811359655003525 -1.451902139073642 0.07819650871015708 -6.105245451167958 -0.1324072673989869 4.615936498606452 -0.5467649002582826 -0.363990505844579 -0.13650389941538213 0.2752074271707381 -0.3338655170036476 2.9487780193088717 0.40019821287813795 4.117986003148169 -0.026780959863113973 -1.1101917759188504 -0.23498474453383608 -1.3228632798048785 -2.354262419036712 0.24308420750931362 -0.1645818411419609 -1.4437550922892162 2.8941579875924344 0.2558467956036607 -0.08814459780887136 0.07087471383894861 2.267507278497597 0.031031443922044502 2.0854726459304396 -0.21733283625573724 -0.1999819336344184 -1.2599866554388457 -0.6871966470843829 1.2455147633396286 -6.526568175634388 1.0307782621458168 -7.048425872433805 0.600579116169935 0.2504273897566358 -0.09427408745581874 -0.33465465162859115 -0.32308019811531374 -3.2159980190640893 -0.16908430382433298 2.0067478951264635 -0.22150819000851285 -3.161536253245908 -7.822592146183477 -0.2632029546935608 0.20856390088984353 -0.22587124732303063 3.1985033387556667 0.01901510816848335 1.281960882048975 -0.6101326365447916 0.4066794227871143 0.032749370204041846 0.580749212327569 0.020218605304891224 6.102399767840279 0.5403363351368605 -1.8743004829536034 0.9134016819901375 0.31985540246334 0.31610311325584417 -2.9528052359256196 -0.16821194217868546 -0.3270534216716528 0.25430533868517585 0.039953323272309695 0.5129078864175823 -1.0878582947501119 -3.0006443577337114 14.482635959067574 -2.205866485139602 2.7404762721349303 1.7497671894086355 0.9583198636903864 -0.013949195263217617 -0.14315511662414362 -0.4397927522661131 -1.3577501945701076 -0.8037514701853001 -2.532449030688125 0.20338491560072233 -0.4507899161410843 -2.2274339272979184 -0.8647814586351603 0.11184881058792277 -0.22822736718419911 -1.9544104517925607 4.48881498689881 -0.015070123006925666 0.23803318676770988 -0.4676579075702204 4.762046592567611 -1.065157665518599 0.36698649976607184 -1.5879018789144397 0.20002589482689223 -9.041748409257522 -2.2672525020911616 -0.9345114241516673 -3.4811402951716857 0.022063383481803863 0.2059936460595231 -0.35740396629588805 -2.3699239112771893 -1.027495575748089 -0.5996610497575394 -0.12186993995018584 -0.8240663689794188 -1.2999587839357876 -1.9482074149323636 -1.4927417583631173 -3.1211408918927446 1.48027679829537 3.8191195438135566 0.25980925939836114 0.19006342230271714 0.499530598113595 2.4391044095659065 -0.1176207064475447 2.174703713289498 0.9217790529193932 0.2625844764234777 0.06777408551092733 -2.0872472586208257 -2.8122299430939925 -0.403084920900534 -1.4024672072477558 4.845740592451458 0.5036364915196372 1.5426561911817338 -0.3821305320163758 3.6832726290129956 0.480329624070939 -1.985249587507281 0.7889348801484201 -0.40341887738958343 -0.25915722889705617 1.3435106810331616 0.05568610322559019 -0.4549430423844065 -0.007186081549999131 0.7489207834255752 0.45978050583417834 -0.6568806714228086 -0.10495150118059714 0.06218937626306283 0.3547073733461225 0.6833622242523779 -0.4741583573543017 -0.54401128181521 -0.2867410499528524 -0.161017511036551 -6.024143323470697 0.23118278365856362 1.314777099100193 -0.030581536631722805 -7.665897662827148 -0.06957086223406536 -3.126610315641824 -0.3664874835156559 0.08952693783212654 -0.40142456191898224 -0.9760336314051915 -4.0331730406373465 0.5506756694354595 0.05767685896761133 -0.5353456205186418 -0.4170011099740233 0.17264469127434132 -0.3778222189272209 0.139728841521226 -0.055037478538710334 -0.22315604973054257 2.647906952538418 1.292665427457963 -0.06918049451020476 -0.6081817884918073 -0.15496785586286013 -0.2510473623856085 -1.0148718285446956 -1.3523704462743185 -7.271101640737253 0.3461364851325806 0.6720616629669748 -0.16919546580714218 -0.11119618680210956 0.08901327960328412 4.02155343660051 -0.07825219503193623 0.8172067821747365 -1.30395355090693 -6.200558542244187 0.25678308078120987 -0.981293711063376 1.4168019953398936 0.09966926060544423 -14.671767000302156 0.009571147677278432 0.6347082481436137 -1.8843019425461434 -0.9723801053668709 -0.8685414978482838 -11.677441636572498 -0.08477232295914232 0.5644398299969121 -0.013559337551321342 1.7044892059684662 -0.018806745957084366 0.44753191570877887 -3.7704113159587465 -0.20838856291620889 0.27172289627818347 -8.441462041682742 -0.07899501613127134')
            let brain = decodeNetwork('8 11 11 13 10 7 6 4 1 0.2124194716570944 0.7587596850798378 -0.9458448734540967 -0.991269727821445 0.508255939817142 -0.347306964866713 -0.3251959871064603 -0.39924212453507474 -1.8253528640540113 -0.6604846493032914 -1.3968954615313507 -1.3714241219019598 -2.293168419406151 -0.40989625978030103 -0.7365644762746555 -0.10842046703744677 -0.28619931707357205 0.6427054621733487 0.532509848815083 -0.15578633926463678 0.2622189112482286 -0.3958906255919528 -0.0032296624884263964 -0.5176412081270888 -0.16636732613477503 3.4986890095353353 0.6284381323307388 1.9256917761808658 0.5360883609982604 -1.2498621348164944 -0.4996369949059474 -0.3235987904684974 -3.2215412825836536 -2.3999182169974285 -0.9377473988186682 0.8500801450418427 -0.7028871339103693 -0.12921186894869974 0.9891268662044327 -1.1686669242605727 2.182421680070706 5.504761678804587 -0.7370605816310168 -2.240241298496449 5.506245736347154 -0.00089421764716359 0.3369052068323679 -4.519972556801193 -2.6368635280582753 -0.6237704261309966 -0.06243788007519542 -0.5245648172899636 0.4137020287271153 1.766880264363234 0.9767902327382871 0.026968891454675042 1.4463366262506794 -0.7121570822656488 -1.3170585690706158 -0.7363111812008887 -0.9755726101367403 1.0826235548933871 0.8347586486481492 0.3335220961892156 0.4478063369844954 -0.22932092084354744 5.267888813770002 -1.6308971601866384 1.5190869476849937 -0.6007173338782285 -4.0601604861154 -1.013523077356375 -0.6658648072954795 1.8858087593285713 -0.605587650408478 0.6484755712846549 1.1333216258661563 -1.4140141802185466 0.6199896572844343 0.24537959659236683 0.10810050001277847 0.5573040412610937 -0.2521876550524271 1.0688927200929994 2.435513275867049 2.12017046156191 -0.5199789283454994 0.2582462613131317 0.06538807193189632 0.5394235491303212 0.6428099060298109 -1.9285444425054243 -0.033067223808539575 -2.030577295398878 -1.0265197904097556 2.191122417390256 0.47336342198931763 -1.4449451787179368 -1.0106917353232567 -0.43456298514539854 -2.529035986189527 -0.01644227394503418 4.9088255351823475 -0.6096928697843202 2.0847934854623444 -4.839241034274081 -0.10670991571061991 -3.164317999198177 -0.00863044086748216 4.547728065960083 -0.23792792027109494 -0.07646822517490087 -0.20510362412568198 0.8522443608951419 -1.430582941706595 -1.744940952362565 -0.4933311433622981 -0.21538160008719884 1.3872484272791432 -0.3874368482199829 -0.18941743868275515 -0.33320621607214246 -0.3956328538381986 1.5977227579979916 0.3814963907288768 1.354616713022217 -0.40002327771818164 -1.5104375240713803 0.23457444646798442 0.35281825811157813 -0.7939560097764506 0.3866575004683293 -2.2722750724170186 -1.256034619289869 0.9229385032386057 -0.003299172641749647 1.6759305163861546 0.33599809613783443 0.6677127376355495 -1.5013190551277293 0.26169113232944624 -0.333588870721613 1.2828711572363596 0.39094394856945053 0.621856461206203 1.286891720758166 -0.1431071398284786 1.2504574119599614 -1.5677272499007568 -0.6403883660183014 -1.300469897542408 1.742226201199463 0.1214776324326657 0.01768310043278096 1.5535734414848652 1.5065757090416745 -0.04715796681241782 0.13573425198758085 1.5904211912877393 1.4115474116496092 1.5043928497568118 -9.69739060485506 -0.7276481370801648 -0.4977431514016882 -1.1603328547158083 1.0941620834888621 0.45602097333580394 3.2859756225936003 -2.099553890344124 0.23789820299260073 0.4365679269743228 -3.274102445637681 1.6199652474163655 -0.6843441472436951 0.1890812932442625 -0.293907573047037 0.04396667799893501 0.5410513603538853 -1.9331914525451754 -0.019250839677887644 1.0587971819006334 1.2282811487897867 0.08731107377880137 -4.9235832510252875 0.8947955462939313 -7.146176241984573 0.270368076494599 0.043081372915541614 -1.2905228499970893 0.07914842251774491 0.48796164526698815 0.32135274707077954 0.484371879283701 -0.09199842662697663 0.4689240841254506 0.107597452777185 1.4479949770545157 -1.2735782473555295 24.82877525043491 -0.24058956301671916 1.0373010096122683 3.5857034191588517 0.37102849627264084 -1.3769728069118308 -0.4381792095114802 1.3310512905090284 -0.5230391012147603 -6.933986866214552 1.4779671791252866 1.388939515493859 -0.849865531815044 2.2232095170786157 0.6321305625901895 -0.2627919177621085 0.9580219634257221 0.7712041768666854 -0.9293134273982349 -1.727897769729253 -0.2440096480765474 -0.19468638191065443 -0.6069960196188268 0.9461671808523382 0.25365842480647405 -0.07440206796562561 1.61577759406534 -0.48001981097199425 0.3024901399132341 -1.6163370298191204 -1.0393078357226004 0.26612635044358735 -3.0212360356239167 1.3064057982255581 3.540831052549915 0.5169316482120114 -0.9948442443412627 -0.27822708902187704 -0.2294675806973037 0.22454248629893736 -0.36235648333283677 -0.3337176484110266 -3.204149096005583 -8.713489110044158 -0.06999357200406706 0.2970193714749282 -2.329963081414771 -0.8549928139924471 -1.1088494103470192 -0.8855269554760649 3.3004845710135977 -3.104839382685737 0.7014609719544378 0.13879867921691333 -0.3187407636727452 1.3108915817262676 -0.4229990380680718 1.2019032763308553 -13.168757005892118 1.319628944164745 -4.483125811675764 2.6456324393879247 -0.22437425857003093 0.799681468922259 -0.07597842409888463 1.0504437019008577 0.9472565566502831 0.8152076428652376 -0.8946928715666067 -1.1421971780458369 -0.23381982334132195 -0.09693233494281342 -0.311208091336759 -0.9187572685956981 -0.21377356628767782 2.3924125155877864 -1.1263086530398245 2.6901960936365197 -0.039967044464916716 -2.86050804680051 4.86766498649464 -1.5627782083352315 -0.9934959915907317 -0.33251316724727076 -0.16338065646274832 -3.362871034962126 -0.2532768989351417 -1.0078984650317009 -0.3752115355868456 1.2996550395264121 -1.4450275240167645 -2.412636014083999 2.316951124049143 0.7732723140130006 -1.1596054793173651 -0.21429274367884088 -0.21834034862846277 1.6723721605120383 -0.7552398003463681 0.6653973626119544 -0.6524707910519729 -0.34864148861138444 -2.1892149546368955 0.516753824219123 -2.2214432063503446 -0.8782519549663564 0.13809885768611013 0.3845559581342205 -2.1766293343036724 0.07722694247892445 2.8566861594608186 -0.920392746557504 0.7931282015403449 -2.0877826128157166 0.9835797709996044 -1.1076185032460841 0.36136942638833647 2.5703504793926744 0.07659779223402649 -0.14681535686102856 0.3270441750417858 6.921481262087245 -1.4777772740096264 -0.28834696622579903 -0.3481024213270431 0.5459671552346348 3.0510352390532876 -0.634964549889158 -1.7854491772650267 -0.27737667591285103 -0.051541769437973305 5.926662341685371 1.9667696578777902 -1.359401532073747 2.3963461641930515 -0.29840936008928 -7.0640576214309005 0.07759694196321136 -1.4978302087222444 -4.69231141370782 1.2728867158734676 -0.28443759811654673 -0.012737412840732844 -0.5196119603501209 -1.3744498807900516 -0.10317109362730303 3.08057164457002 0.4374948399156388 0.7501314373414866 -0.7772236653595933 0.12818742384992118 -1.1215886773883472 -0.8823500718006203 0.8548867514279997 -1.020003035480707 -2.257101249619141 -0.7706604891139041 -0.19809331941048994 -0.8955304956305241 0.7462460967006667 -0.34705555865883353 0.8343387269248508 -1.7673014498047461 -5.140982149725526 1.2427658130297046 0.4689588226088885 1.9119525091729155 -1.7286141207842713 -8.5827872268765 -3.04729305280054 0.11866186831697155 -3.972659477066708 0.1875225766463806 0.42237372323840283 -0.45194546735987506 -0.7328579712490065 1.6182772395802065 1.792263926581135 -0.11682468333879661 0.10071119523751214 1.3522018894810537 0.34053643092482905 1.923971875670552 1.5815991946029608 1.6713708687017732 0.09242481290812612 -1.0818953579234418 -1.6976116924352378 -0.25417317195345884 2.03406804992681 -2.681007579421831 1.2736111529026688 3.6148960546095936 -0.5993248643390447 0.23827751887104137 0.8090231829447264 -0.22914183046854536 -0.2776850724100429 0.3269539662077879 -2.022420579647126 0.15923969898196727 -5.313142652527897 0.555658853372579 5.358198867665213 -15.478908663540137 1.8249705804857597 -1.6573051198131663 0.6172492075483071 -0.39138446640391816 -1.879375168398306 0.9759015929296818 0.5452181900576253 2.449632933098858 1.296215690660749 -0.2018390538142583 0.16092861080558474 1.928343031939288 -0.3822988399431833 1.7546863306622 -0.3745130570444167 0.9753052212815154 2.444791211356008 -3.3607883648108894 0.5658104323273002 -12.282202422999191 0.6146284784877157 1.2301153501101472 -10.442623926591452 -0.36615033751953796 0.865448093525755 -0.24328255680883146 -0.4777500724370389 -0.7319362637339268 -0.777055561995589 0.7393323246783127 0.26818512702747543 -0.5565809626622625 -1.8810666119348798 0.21285114454173687 -0.11262238351456558 -0.08639138194182067 -0.5423423354927229 1.2119889538069382 2.407552086226088 0.1444356353201821 0.15628820678937566 -0.7338512533568632 -0.34869558385582033 1.1909463555237167 0.5703945039811914 0.2817073712036586 -0.7145236367684041 -0.8184101431987917 1.02329273529436 0.03042318369001468 0.003684568928770586 -0.6980501847662377 1.3827074853160384 -3.466639823208428 0.28784473821412254 -1.314057952243228 -0.42458751890603824 1.7287049447839125 -0.686565761756452 1.4900110753959968 1.7978328058346147 -0.2270298537738935 -5.065827153265371 -0.619592976870093 6.346991237893877 5.303512702870454 -0.4843072646389479 0.2411843532715143 2.5649175907056594 -1.1652081684910531 -1.1962964367377074 -1.4280179725379842 -0.19731943536044877 1.4353638177730428 0.5414333439806012 0.4029262843207807 0.42853023452085787 0.14768441823155892 -3.0514990492503187 -0.14278340379273996 -0.020112687678722693 -3.7680253552950296 -1.0492102216327615 -4.1671269533230735 0.9717889153446501 2.864435117889851 0.437497701388496 1.726739216988754 0.4866934543776708 -0.25755806465212017 0.8984115475566788 0.5268177207316854 0.40305476868296997 -1.1505106940175196 0.7312869401249987 0.10963702366443805 -3.2366974687725936 -0.5713540488054689 0.42709608782332825 -0.9135210657816089 -0.0962742445966923 1.6762725355512365 -0.3408238197708363 0.40410691325761905 0.012076498805694955 5.317794187211052 0.5382558446649709 0.08122340197467114 2.225314636188697 1.5130804438140089 0.08523891995637367 0.1778144013527987 -3.571173126641569 -0.05541479716771927 -0.23979217532518032 -2.6705969455351455 -0.828255191100133 0.08879579190645973 -0.7074002092933022 1.2239514933205935 1.2022637078878158 1.5705670133048708 -0.5918584064962122 -4.93486921774159 0.261294383871457 -0.24581427742094186 1.857467477087399 -0.4388990778568087 3.193064606932925 -0.6098520138981773 -2.0013136291775067 -0.2603274783542218 -0.7273496345230829 -0.17297017153490082 -0.006938471917999746 0.43421654647992186 2.379706295888535 2.008110865477354 -0.12261024346088252 4.646871214156608 -0.26506189248747014 0.062313143507835546 -0.3023425618022741 -0.06093224649827973 -0.9034922590718293 0.08291908262814045 0.15226500750040034 2.690812252560493 3.4469771897124493 -0.43613571478448354 -1.2978098440726225 -0.8396179930330191 -2.531441877856738 -0.8497193189149063 0.6989721690099907 -0.34462907918878255 1.0677532298588386 1.2642882974941454 -0.6192118402088401 -0.19547891059616598 -0.19366924994259252 0.21211119144388743 1.3139424726304496 1.0767508626219553 -0.9490688386582822 -0.07392793098036077 0.5399321261577045 0.6034456125354678 2.0868295268041055 0.06263072652928849 -1.3530926098759273 -0.025398611321992188 -0.170910323387582 1.807553217719922 0.7355890251725549 -0.17634743762905758 -0.013702207832713708 0.9874280433986413 -0.3481819807635115 -2.1415624128642317 0.417705689721232 -0.5195914971049209 0.08297840117992274 0.38446581106265726 -3.0507262575844405 -1.1868639577145248 0.048367519496259836 -4.928451400887299 -0.6767452217010722 1.9621157818704944 -1.9887608549412281 0.7281073182924002 -3.389448176422194 0.3523012351525495')
            entityList.NNs[i].biasArray = brain[0];
            entityList.NNs[i].weightArray = brain[1];

            globals.fitnessDictionary[i] = i;
        }
        simulationReset(false);
    }
    
}